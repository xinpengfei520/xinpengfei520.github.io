<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.8.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.vance.xin","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Android、Java Developer.">
<meta name="keywords" content="Android Java Program Code 编程 面试 职场">
<meta property="og:type" content="website">
<meta property="og:title" content="程序员飞飞">
<meta property="og:url" content="https://www.vance.xin/page/2/index.html">
<meta property="og:site_name" content="程序员飞飞">
<meta property="og:description" content="Android、Java Developer.">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="程序员飞飞">
<meta name="twitter:description" content="Android、Java Developer.">

<link rel="canonical" href="https://www.vance.xin/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>程序员飞飞</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">程序员飞飞</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">码农，产品思维实践者，终身学习者，微信公众号：「程序员飞飞」。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vance.xin/2019/05/30/Android library 依赖 aar 包的两种方式/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="程序员飞飞">
      <meta itemprop="description" content="Android、Java Developer.">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员飞飞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/30/Android library 依赖 aar 包的两种方式/" class="post-title-link" itemprop="url">Android library 依赖 aar 包的两种方式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-05-30 17:12:05 / 修改时间：17:13:36" itemprop="dateCreated datePublished" datetime="2019-05-30T17:12:05+08:00">2019-05-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="方式1"><a href="#方式1" class="headerlink" title="方式1"></a>方式1</h2><p>将 aar 包放入 library module 的 libs 目录下，然后在工程的 build.gradle 文件中加入如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flatDir &#123; dirs &apos;libs&apos;, &apos;../moduleName/libs&apos; &#125;</span><br></pre></td></tr></table></figure>
<p>注：将 moduleName 替换为你自己的 library module 的 name.</p>
<p>然后在 module 的 build.gradle 文件中添加依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation(name: &apos;aar包名&apos;, ext: &apos;aar&apos;)</span><br></pre></td></tr></table></figure>
<h2 id="方式2"><a href="#方式2" class="headerlink" title="方式2"></a>方式2</h2><p>这种方式的思路是，先把 aar 包放入一个单独的文件夹中，然后我们再依赖这个文件夹就可以了，这个文件夹你也可以理解成一个特殊的 module。</p>
<p>先在工程目录下新建一个文件夹（和app同级），然后将你的 aar 包放入 这个文件夹，然后再新建一个 build.gradle 文件，在这个文件中添加下面两句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">configurations.maybeCreate(&quot;default&quot;)</span><br><span class="line">artifacts.add(&quot;default&quot;, file(&apos;aar包名.aar&apos;))</span><br></pre></td></tr></table></figure>
<p>然后在你需要依赖的 library module 的 build.gradle 文件中添加依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">implementation project(&apos;:存放aar包的文件夹&apos;)</span><br></pre></td></tr></table></figure>
<p>最后，同步下工程就 OK 了~</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vance.xin/2019/05/27/RxJava2.x 变换操作符之 flatMap和concatMap/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="程序员飞飞">
      <meta itemprop="description" content="Android、Java Developer.">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员飞飞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/27/RxJava2.x 变换操作符之 flatMap和concatMap/" class="post-title-link" itemprop="url">RxJava2.x 变换操作符之 flatMap 和 concatMap</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-05-27 23:17:00 / 修改时间：23:17:26" itemprop="dateCreated datePublished" datetime="2019-05-27T23:17:00+08:00">2019-05-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="http://image.x-sir.com/Fu8NaLmujOyoQjtSrpLnPsxWWp3a" alt=""><br>题图：Pixabay License</p>
<p>哈喽，朋友们，<a href="https://mp.weixin.qq.com/s?__biz=MzU4MTIzNjg0Ng==&amp;mid=2247484144&amp;idx=1&amp;sn=28e8940cc3a692057a7a3634f04d52f7&amp;chksm=fd4be3f1ca3c6ae765a83e4d6b7d9668f2c212ea3258e7e3cf6cb5ab22c3973720ef5cc7d0a8&amp;token=759890379&amp;lang=zh_CN#rd" target="_blank" rel="noopener">上一篇文章</a>我们学习了 filter 操作符，今天我们来学习 RxJava 中比较重要的两个操作符 flatMap 和 concatMap。</p>
<h2 id="1-flatMap"><a href="#1-flatMap" class="headerlink" title="1.flatMap"></a>1.flatMap</h2><p>我们知道 flat 是平的意思，这个翻译还是有点生硬和抽象，我们还是不太理解，你就可以先理解成平铺的意思吧。</p>
<p>flatMap 是变换操作符的一种，它将一个发射数据的 Observable 变换为多个 Observable，然后将他们发射的数据合并后放入一个单独的 Observable。</p>
<p>举个简单的例子吧，假设上游有个数据源，数据源是学生对象的集合，学生有姓名和课程的属性，每个学生的课程可以有多个，需求是打印出所有学生的课程名称。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Student student1 = new Student();</span><br><span class="line"></span><br><span class="line">List&lt;Student.Course&gt; list1 = new ArrayList&lt;&gt;();</span><br><span class="line">list1.add(new Student.Course(&quot;语文1&quot;));</span><br><span class="line">list1.add(new Student.Course(&quot;数学1&quot;));</span><br><span class="line">list1.add(new Student.Course(&quot;英语1&quot;));</span><br><span class="line">list1.add(new Student.Course(&quot;物理1&quot;));</span><br><span class="line">list1.add(new Student.Course(&quot;化学1&quot;));</span><br><span class="line"></span><br><span class="line">student1.setName(&quot;张三&quot;);</span><br><span class="line">student1.setCourses(list1);</span><br><span class="line"></span><br><span class="line">Student student2 = new Student();</span><br><span class="line"></span><br><span class="line">List&lt;Student.Course&gt; list2 = new ArrayList&lt;&gt;();</span><br><span class="line">list2.add(new Student.Course(&quot;语文2&quot;));</span><br><span class="line">list2.add(new Student.Course(&quot;数学2&quot;));</span><br><span class="line">list2.add(new Student.Course(&quot;英语2&quot;));</span><br><span class="line"></span><br><span class="line">student2.setName(&quot;李四&quot;);</span><br><span class="line">student2.setCourses(list2);</span><br><span class="line"></span><br><span class="line">List&lt;Student&gt; studentList = new ArrayList&lt;&gt;();</span><br><span class="line">studentList.add(student1);</span><br><span class="line">studentList.add(student2);</span><br><span class="line"></span><br><span class="line">Observable.just(studentList)</span><br><span class="line">        .flatMap((Function&lt;List&lt;Student&gt;, ObservableSource&lt;Student&gt;&gt;) students -&gt; Observable.fromIterable(students))</span><br><span class="line">        .flatMap((Function&lt;Student, ObservableSource&lt;Student.Course&gt;&gt;) student -&gt; &#123;</span><br><span class="line">            LogUtil.i(TAG, &quot;student name===&quot; + student.getName());</span><br><span class="line">            return Observable.fromIterable(student.getCourses());</span><br><span class="line">        &#125;)</span><br><span class="line">        .subscribe(course -&gt; LogUtil.i(TAG, &quot;course===&quot; + course.getCourseName()));</span><br></pre></td></tr></table></figure>
<p>执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">I/RxJavaOperatorActivity: student name===张三</span><br><span class="line">I/RxJavaOperatorActivity: course===语文1</span><br><span class="line">I/RxJavaOperatorActivity: course===数学1</span><br><span class="line">I/RxJavaOperatorActivity: course===英语1</span><br><span class="line">I/RxJavaOperatorActivity: course===物理1</span><br><span class="line">I/RxJavaOperatorActivity: course===化学1</span><br><span class="line">I/RxJavaOperatorActivity: student name===李四</span><br><span class="line">I/RxJavaOperatorActivity: course===语文2</span><br><span class="line">I/RxJavaOperatorActivity: course===数学2</span><br><span class="line">I/RxJavaOperatorActivity: course===英语2</span><br></pre></td></tr></table></figure>
<p>我们看到上面的代码没有 for 循环，却遍历打印了集合中的数据，RxJava 就是为了简化或者是取消 for 循环种方式，使用操作符来解决遍历循环的问题，从而是代码更加扁平化，使代码更加清晰和便于理解。</p>
<p>注意：flatMap 对这些 Observables 发射的数据做的是合并(merge)操作，因此它们可能是交错的，即不能保证数据的发射顺序。</p>
<h2 id="2-concatMap"><a href="#2-concatMap" class="headerlink" title="2.concatMap"></a>2.concatMap</h2><p>我们将上面的 flatMap 操作符换成 concatMap 操作符再看看打印的结果，修改代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(studentList)</span><br><span class="line">            .concatMap((Function&lt;List&lt;Student&gt;, ObservableSource&lt;Student&gt;&gt;) students -&gt; Observable.fromIterable(students))</span><br><span class="line">            .concatMap((Function&lt;Student, ObservableSource&lt;Student.Course&gt;&gt;) student -&gt; &#123;</span><br><span class="line">                LogUtil.i(TAG, &quot;student name===&quot; + student.getName());</span><br><span class="line">                return Observable.fromIterable(student.getCourses());</span><br><span class="line">            &#125;)</span><br><span class="line">            .subscribe(course -&gt; LogUtil.i(TAG, &quot;course===&quot; + course.getCourseName()));</span><br></pre></td></tr></table></figure>
<p>执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">I/RxJavaOperatorActivity: student name===张三</span><br><span class="line">I/RxJavaOperatorActivity: course===语文1</span><br><span class="line">I/RxJavaOperatorActivity: course===数学1</span><br><span class="line">I/RxJavaOperatorActivity: course===英语1</span><br><span class="line">I/RxJavaOperatorActivity: course===物理1</span><br><span class="line">I/RxJavaOperatorActivity: course===化学1</span><br><span class="line">I/RxJavaOperatorActivity: student name===李四</span><br><span class="line">I/RxJavaOperatorActivity: course===语文2</span><br><span class="line">I/RxJavaOperatorActivity: course===数学2</span><br><span class="line">I/RxJavaOperatorActivity: course===英语2</span><br></pre></td></tr></table></figure>
<p>我们看到和 flatMap 的执行结果是一样的，我们发现打印的结果也是按照添加数据的顺序打印出来了，理论上 flatMap 执行的结果可能会有交错，原因是我们添加的数据过少，因此它们执行的时间也是差不多的，所以提现不出交错的情况。</p>
<p>好了，今天的学习内容就算完成了，感觉是不是非常简单？其实有时候你光看，理解起来是很慢的，但是你动手敲一遍立马就明白了，所以代码这个东西还是得多敲！</p>
<p>最后，我这边建了一个技术交流群，需要的朋友可以扫描下面的二维码加我微信并备注「加群」，拉你进入技术交流群！</p>
<p><img src="http://image.x-sir.com/FoiEznYF5eSQS8WMN62NzUQ4gk40 =337x448" alt=""></p>
<p>飞哥带你去装逼，一直装逼到天黑！</p>
<p>另外，我还建了一个免费的知识星球用于学习交流，感兴趣的可以使用微信扫码加入哦！</p>
<p><img src="https://img-blog.csdnimg.cn/2019052722451347.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbnBlbmdmZWk1MjE=,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vance.xin/2019/05/23/RxJava2.x 操作符之 filter/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="程序员飞飞">
      <meta itemprop="description" content="Android、Java Developer.">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员飞飞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/23/RxJava2.x 操作符之 filter/" class="post-title-link" itemprop="url">RxJava2.x 操作符之 filter</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-05-23 17:20:00 / 修改时间：17:19:19" itemprop="dateCreated datePublished" datetime="2019-05-23T17:20:00+08:00">2019-05-23</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="http://image.x-sir.com/FgcNl-lC_eHGqFwCEaAENRaAGT5r" alt=""><br>题图：Pixabay License</p>
<p>哈喽，朋友们，<a href="https://mp.weixin.qq.com/s/EV4afZ27lQZ8xLxnZjLZow" target="_blank" rel="noopener">上一篇文章</a>我们学习了 repeate 操作符，今天我们继续来学习 filter 操作符。</p>
<p>我们都知道 filter 是过滤的意思，也就是说这个操作符就是帮助我们来过滤掉一些我们不需要的数据。</p>
<p>举个简单的例子吧，假设上游有个数据源，顺序向下游发送 0-9 十个数字，我们只想打印大于 5 的数字，我们就可以这么写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Observable.interval(1, TimeUnit.SECONDS)</span><br><span class="line">   .take(10)</span><br><span class="line">   .filter(new Func1&lt;Long, Boolean&gt;() &#123;</span><br><span class="line">           @Override</span><br><span class="line">           public Boolean call(Long aLong) &#123;</span><br><span class="line">               return aLong &gt; 5;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;)</span><br><span class="line">   .subscribe(new Action1&lt;Long&gt;() &#123;</span><br><span class="line">           @Override</span><br><span class="line">           public void call(Long aLong) &#123;</span><br><span class="line">               LogUtil.i(&quot;aLong===&quot; + aLong);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br></pre></td></tr></table></figure>
<p>执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">I/RxJavaOperatorActivity: aLong===6</span><br><span class="line">I/RxJavaOperatorActivity: aLong===7</span><br><span class="line">I/RxJavaOperatorActivity: aLong===8</span><br><span class="line">I/RxJavaOperatorActivity: aLong===9</span><br></pre></td></tr></table></figure>
<p>结果打印出来的都是大于 5 的数字，当然你还可以设置其他的过滤条件，例如空值等！</p>
<p>好了，今天的学习内容就算完成了，感觉是不是非常简单？如果你学会了就赶紧动手去实践一下吧，说不定你会有新的发现哦！</p>
<p>最后，我和大家分享一下我学习的一些经验或者是见解吧。我们再学习的过程中，可能学的很多东西都是点状的，我们要把学习到的东西学会融会贯通，将他们连接成线即学会相互联系，再将线形成面，再形成体，这样我们学到的知识才能形成一个完整的知识体系，不要只见树叶，不见森林，希望大家在学习的过程中，多思考，多总结！</p>
<p>Ps:扫描下面的二维码，关注「IT大飞说」，回复「加群」，拉你进入兄弟战斗群，最后告诉你们一个小秘密，公号对话框回复「装备01」 送你一件珍藏版的打怪装备，战斗力瞬间可增加 80！！！我使用过，效果杠杠滴！从此，我们就可以一起愉快的装逼了！</p>
<p>飞哥带你去装逼，一直装逼到天黑！</p>
<p>更多干货文章请关注我的微信公众号：<br><img src="https://img-blog.csdn.net/20180626144909992?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbnBlbmdmZWk1MjE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="扫一扫关注"></p>
<p>另外，我还建了一个免费的知识星球，感兴趣的微信扫码即可加入！</p>
<p><img src="http://image.x-sir.com/zsxq_qrcodezsxq_qrcode.jpg" alt="image"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vance.xin/2019/05/21/RxJava2.x操作符之repeat/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="程序员飞飞">
      <meta itemprop="description" content="Android、Java Developer.">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员飞飞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/21/RxJava2.x操作符之repeat/" class="post-title-link" itemprop="url">RxJava2.x 操作符之 repeat</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-21 23:51:56" itemprop="dateCreated datePublished" datetime="2019-05-21T23:51:56+08:00">2019-05-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-05-22 00:10:15" itemprop="dateModified" datetime="2019-05-22T00:10:15+08:00">2019-05-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="http://image.x-sir.com/FqDMiECeHHogPYMQOD61PzhARXlC" alt=""><br>题图：Pixabay License</p>
<p>哈喽，朋友们，<a href="https://mp.weixin.qq.com/s?__biz=MzU4MTIzNjg0Ng==&amp;mid=2247484126&amp;idx=1&amp;sn=e94a44088c9697aa36ff1ddf91e35ced&amp;chksm=fd4be3dfca3c6ac969c0ccfb39d364bbca18b651f8cd36ed1e07af174775acebcd0426a6745a&amp;token=887755948&amp;lang=zh_CN#rd" target="_blank" rel="noopener">上一篇文章</a>我们学习了 from 操作符，今天我们继续来学习 repeat 操作符。</p>
<p>我们都知道 repeat 是重复的意思，也就是说这个操作符就是帮助我们来操作处理一些重复的数据或者操作，repeat 有三个相关的操作符：repeat、repeatWhen、repeatUntil，从字面也很好理解，repeat 就是简单的重复操作，repeatWhen 当达到什么条件的时候重复，repeatUntil 是直到某个条件不在重复。</p>
<h2 id="1-repeat"><a href="#1-repeat" class="headerlink" title="1.repeat"></a>1.repeat</h2><p>举个简单的例子吧，例如我们想重复打印一下 “Hello World!”，我们就可以这么写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">private void repeat() &#123;</span><br><span class="line">    Observable.just(&quot;Hello World!&quot;)</span><br><span class="line">            .repeat(3)</span><br><span class="line">            .subscribe(s -&gt; LogUtil.i(TAG, s));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>很简单吧，这个就不用我多说了吧。需要注意的是，如果不指定重复的次数，则会无限地重复下去！</p>
<h2 id="2-repeatWhen"><a href="#2-repeatWhen" class="headerlink" title="2.repeatWhen"></a>2.repeatWhen</h2><p>例如，我们想按顺序打印 0-3 的数字，当 2 秒后我们再重复打印一次，我们就可以这么写。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Observable.range(0, 4)</span><br><span class="line">            .repeatWhen(objectObservable -&gt; Observable.timer(2, TimeUnit.SECONDS))</span><br><span class="line">            .subscribe(integer -&gt; LogUtil.i(TAG, &quot;integer===&quot; + integer));</span><br></pre></td></tr></table></figure>
<p>上面的代码也比较简单，首先我们使用了一个新的操作符 range，也就是范围的意思，我们可以用它来指定一个数字的范围，并按顺序发射出去，repeatWhen 中使用了一个新的操作符 timer，我们用他创建了一个定时器的被观察者对象，并指定了两秒的时长，当到达 2 秒时就会重复原始的 Observable 并重新订阅和发射。</p>
<h2 id="3-repeatUntil"><a href="#3-repeatUntil" class="headerlink" title="3.repeatUntil"></a>3.repeatUntil</h2><p>例如，我想间隔 1 秒顺序打印数字 0-2，当从开始打印到第 5 秒的时候就停止打印，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Observable.interval(1000, TimeUnit.MILLISECONDS)</span><br><span class="line">            .take(3)</span><br><span class="line">            .repeatUntil(() -&gt; System.currentTimeMillis() - currentTimeMillis &gt; 5000)</span><br><span class="line">            .subscribe(aLong -&gt; LogUtil.i(TAG, &quot;aLong===&quot; + aLong));</span><br></pre></td></tr></table></figure>
<p>这里我们使用了一个新的操作符 interval，它可以指定时间单位的时长发送数字序列，还有一个操作符是 take，它表示只取前 3 个，注意：从 0 开始，不包含它自己，接下来我们在 repeatUntil 里加了个判断，当大于 5 秒就停止重复打印。</p>
<p>执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">I/RxJavaOperatorActivity: aLong===0</span><br><span class="line">I/RxJavaOperatorActivity: aLong===1</span><br><span class="line">I/RxJavaOperatorActivity: aLong===2</span><br><span class="line">I/RxJavaOperatorActivity: aLong===0</span><br><span class="line">I/RxJavaOperatorActivity: aLong===1</span><br><span class="line">I/RxJavaOperatorActivity: aLong===2</span><br></pre></td></tr></table></figure>
<p>怎么样？是不是立马就明白了。</p>
<p>好了，今天的学习内容就算完成了，感觉是不是非常简单？如果你学会了就赶紧动手去实践一下吧，说不定你会有新的发现哦！</p>
<p>最后，我和大家分享一下我学习的一些经验或者是见解吧。我们再学习的过程中，可能学的很多东西都是点状的，我们要把学习到的东西学会融会贯通，将他们连接成线即学会相互联系，再将线形成面，再形成体，这样我们学到的知识才能形成一个完整的知识体系，不要只见树叶，不见森林，希望大家在学习的过程中，多思考，多总结！</p>
<p>Ps:扫描下面的二维码，关注「IT大飞说」，回复「加群」，拉你进入兄弟战斗群，最后告诉你们一个小秘密，公号对话框回复「装备01」 送你一件珍藏版的打怪装备，战斗力瞬间可增加 80！！！我使用过，效果杠杠滴！从此，我们就可以一起愉快的装逼了！</p>
<p>飞哥带你去装逼，一直装逼到天黑！</p>
<p>更多干货文章请关注我的微信公众号：<br><img src="https://img-blog.csdn.net/20180626144909992?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbnBlbmdmZWk1MjE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="扫一扫关注"></p>
<p>另外，我还建了一个免费的知识星球，感兴趣的微信扫码即可加入！</p>
<p><img src="http://image.x-sir.com/zsxq_qrcodezsxq_qrcode.jpg" alt="image"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vance.xin/2019/05/19/RxJava2.x创建操作符之from/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="程序员飞飞">
      <meta itemprop="description" content="Android、Java Developer.">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员飞飞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/19/RxJava2.x创建操作符之from/" class="post-title-link" itemprop="url">RxJava2.x 创建操作符之 from</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-19 18:34:56" itemprop="dateCreated datePublished" datetime="2019-05-19T18:34:56+08:00">2019-05-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-08 17:22:24" itemprop="dateModified" datetime="2020-04-08T17:22:24+08:00">2020-04-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="http://image.x-sir.com/FstPHz-8U7d4k5MmkgEMSV2u4jZI" alt=""><br>题图：Pixabay License</p>
<p>哈喽，朋友们，<a href="https://mp.weixin.qq.com/s?__biz=MzU4MTIzNjg0Ng==&amp;mid=2247484120&amp;idx=1&amp;sn=92c23454794cd38b6b10f3584446a4ef&amp;chksm=fd4be3d9ca3c6acfd6154829fc2c4a0dd8ce778301d861a834e906d37500a8e9c69e78c0671f&amp;token=109718556&amp;lang=zh_CN#rd" target="_blank" rel="noopener">上一篇文章</a>我们学习了 create &amp; just 操作符，今天我们继续来学习 from 操作符。</p>
<p>from 操作符和 just 操作符一样，也属于创建操作符的一种，from 可将其他种类的对象和数据类型转换为 Observable。</p>
<p>从概念看，just 和 from 是比较相似的，那么，他们两者有什么区别呢？</p>
<p>just 只是简单的原样发射，它会将数组或 Iterable 当做单个数据发射出去，而 from 会将数组或 Iterable 的数据按顺序取出来，然后逐个发射出去，举个例子你就明白了。</p>
<p>举例，我们初始化了一个 list，分别用 just 和 fromIterable 操作符进行处理，并打印了数据的结果。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Integer&gt; list = new ArrayList&lt;&gt;();</span><br><span class="line">for (int i = 0; i &lt; 6; i++) &#123;</span><br><span class="line">    list.add(i);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Observable.just(list).subscribe((Consumer&lt;List&gt;) list1 -&gt; LogUtil.i(TAG, &quot;just():&quot; + Arrays.toString(list1.toArray())));</span><br><span class="line"></span><br><span class="line">Observable.fromIterable(list).subscribe(integer -&gt; LogUtil.i(TAG, &quot;fromIterable():&quot; + integer));</span><br></pre></td></tr></table></figure>
<p>执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">I/RxJavaOperatorActivity: just():[0, 1, 2, 3, 4, 5]</span><br><span class="line">I/RxJavaOperatorActivity: fromIterable():0</span><br><span class="line">I/RxJavaOperatorActivity: fromIterable():1</span><br><span class="line">I/RxJavaOperatorActivity: fromIterable():2</span><br><span class="line">I/RxJavaOperatorActivity: fromIterable():3</span><br><span class="line">I/RxJavaOperatorActivity: fromIterable():4</span><br><span class="line">I/RxJavaOperatorActivity: fromIterable():5</span><br></pre></td></tr></table></figure>
<p>从上面打印的日志我们可以看到，just 是将整个 list 数据传递下来了，而 fromIterable 是将 list 中的数据遍历并一个一个发射出去，数组也是一样的道理，数组使用 fromArray 操作符。</p>
<p>这里需要注意一个点，just 是可以接收 1-10 参数的，如果传入 1-5 的数字作为参数，那么它也会按顺序去打印的，而不是作为一个数组发射出去。</p>
<p>举个例子你就明白了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Observable.just(1, 2, 3, 4, 5).subscribe(integer -&gt; LogUtil.i(TAG, &quot;just():&quot; + integer));</span><br></pre></td></tr></table></figure>
<p>执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">I/RxJavaOperatorActivity: just():1</span><br><span class="line">I/RxJavaOperatorActivity: just():2</span><br><span class="line">I/RxJavaOperatorActivity: just():3</span><br><span class="line">I/RxJavaOperatorActivity: just():4</span><br><span class="line">I/RxJavaOperatorActivity: just():5</span><br></pre></td></tr></table></figure>
<p>怎么样？是不是瞬间就懂了。</p>
<p>另外，from 还有一个 fromFuture 操作符，Future 是什么东西？fromFuture 又是如何使用的呢？这个问题问的好，大飞这就给你细细道来。</p>
<p>Future 是 java.util.concurrent 包下的一个接口，我们都知道，创建线程的 2 种方式，一种是直接继承 Thread，另外一种就是实现 Runnable接口，但是这 2 种方式都有一个缺点就是在执行完任务之后无法获取执行的结果。</p>
<p>如果需要获取执行结果，就必须通过共享变量或者使用线程通信的方式来达到效果，这样使用起来就比较麻烦。而自从 JDK 1.5 开始，给我们提供了 Callable 和 Future 接口，通过这两个接口我们可以在任务执行完毕之后得到线程执行的结果。</p>
<p>一般来说，Callable 需要和 ExecutorService 配合来使用的，举个非常简单的例子吧。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">static class MyCallable implements Callable&lt;Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Integer call() throws Exception &#123;</span><br><span class="line">        LogUtil.i(TAG, &quot;call():在这里模拟一些耗时操作...&quot;);</span><br><span class="line">        Thread.sleep(3000);</span><br><span class="line">        int sum = 0;</span><br><span class="line">        for (int i = 0; i &lt;= 100; i++) &#123;</span><br><span class="line">            sum += i;</span><br><span class="line">        &#125;</span><br><span class="line">        return sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void calculate() &#123;</span><br><span class="line">    ExecutorService executorService = Executors.newCachedThreadPool();</span><br><span class="line">    Future&lt;Integer&gt; future = executorService.submit(new MyCallable());</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">        LogUtil.i(TAG, &quot;任务运行的结果：&quot; + future.get());</span><br><span class="line">    &#125; catch (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (ExecutionException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码也比较简单，我相信大家都能看得懂，我们的 MyCallable 类实现了 Callable 接口，在 call 方法中进行了一些耗时的操作，然后将结果返回出去，紧接着我们创建了一个线程池，创建了一个 MyCallable 的对象并将其提交到线程池中，最后将执行的结果打印出来。</p>
<p>执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2019-05-19 16:22:36.932 I/RxJavaOperatorActivity: call():在这里模拟一些耗时操作...</span><br><span class="line">2019-05-19 16:22:40.933 I/RxJavaOperatorActivity: 任务运行的结果：5050</span><br></pre></td></tr></table></figure>
<p>我们再来看看如何配合 RxJava 来使用，这里使用到了 fromFuture 操作符，其实使用起来非常简单，简单修改一下上面的代码，相信你立刻就秒懂了！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Observable.fromFuture(future).subscribe(s -&gt; LogUtil.i(TAG, &quot;任务运行的结果：&quot; + s));</span><br></pre></td></tr></table></figure>
<p>这里我们就不调用 future 的 get 方法来获取执行的结果了，而是将 future 对象使用 fromFuture 操作符将其作为参数传递进去，当任务执行完成后，我们的观察者就会收到执行完后的结果，说白了就是 RxJava 内部帮你执行了 get 的方法并把结果回调给你了。</p>
<p>总结一下，对于 Future，它会发射 Future.get() 方法返回的单个数据。</p>
<p>细心的你可能已经发现了，fromFuture 还有一个重载方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fromFuture(Future&lt;? extends T&gt; future, long timeout, TimeUnit unit)；</span><br></pre></td></tr></table></figure>
<p>那第二个参数和第三个参数是什么意思呢？先别急，我们先看下 Future 接口的定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public interface Future&lt;V&gt; &#123;</span><br><span class="line">    boolean cancel(boolean mayInterruptIfRunning);</span><br><span class="line">    boolean isCancelled();</span><br><span class="line">    boolean isDone();</span><br><span class="line">    V get() throws InterruptedException, ExecutionException;</span><br><span class="line">    V get(long timeout, TimeUnit unit)</span><br><span class="line">        throws InterruptedException, ExecutionException, TimeoutException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>看到没有，我们发现原来 get 方法也有一个重载方法，也就是说 fromFuture 3 个参数的方法中后两个参数对应的就是 get 重载方法中的这两个参数。</p>
<p>那么问题来了，这两个参数有什么作用呢？这两参数的意思是，我们可以指定执行任务的时长和时间单位，如果过了指定的时长，Future 还没有返回一个结果，那么这个 Observable 就会发射异常通知并终止。</p>
<p>我们可以测试一下是不是这样的。我们现在指定一个执行任务的时长，我在执行任务的方法中睡了 3 秒，那么这里我就给它设置成 2 秒，这样设置，任务肯定是没有执行完成的，我们看看这个时候会不会和我们猜测的一样会抛异常。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Observable.fromFuture(future, 2, TimeUnit.SECONDS).subscribe(s -&gt; Observable.fromFuture(future, 2, TimeUnit.SECONDS)</span><br><span class="line">                .subscribe(s -&gt; LogUtil.i(TAG, &quot;任务运行的结果：&quot; + s)</span><br><span class="line">                        , throwable -&gt; LogUtil.e(TAG, &quot;onError:&quot; + throwable.getMessage()));</span><br></pre></td></tr></table></figure>
<p>执行结果如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">I/RxJavaOperatorActivity: call():在这里模拟一些耗时操作...</span><br><span class="line">E/RxJavaOperatorActivity: onError:null</span><br></pre></td></tr></table></figure>
<p>看到没有，果不其然报错了，这样我们就可以在超时的时候做一些处理了。</p>
<p>好了，我们今天的学习目标就算达成了，感觉是不是很简单，很轻松？我们来回顾下今天所学的东西，首先我们学习了 fromIterable 操作符，它与 just 操作符有相似之处，因此我将其与 just 操作符举例说明了他们的区别。</p>
<p>紧接着我们回顾了 Java 中创建线程的相关知识，并学会了将其配合 fromFuture 操作符一起使用，真的是非常方便的。</p>
<p>如果你学会了就赶紧动手去实践一下吧，有数据表明，学习后实践的吸收效果比不实践的效果高几十倍！</p>
<p>今天的内容确实比较轻松和简单，后面我将继续带领大家一起学习新的内容，大家敬请期待吧！</p>
<p>最后，我和大家分享一下我学习的一些经验或者是见解吧。我们再学习的过程中，可能学的很多东西都是点状的，我们要把学习到的东西学会融会贯通，将他们连接成线即学会相互联系，再将线形成面，再形成体，这样我们学到的知识才能形成一个完整的知识体系，不要只见树叶，不见森林，希望大家在学习的过程中，多思考，多总结！</p>
<p>Ps:扫描下面的二维码，关注「IT大飞说」，回复「加群」，拉你进入兄弟战斗群，最后告诉你们一个小秘密，公号对话框回复「装备01」 送你一件珍藏版的打怪装备，战斗力瞬间可增加 80！！！我使用过，效果杠杠滴！从此，我们就可以一起愉快的装逼了！</p>
<p>飞哥带你去装逼，一直装逼到天黑！</p>
<p>更多干货文章请关注我的微信公众号：<br><img src="https://img-blog.csdn.net/20180626144909992?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbnBlbmdmZWk1MjE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="扫一扫关注"></p>
<p>另外，我还建了一个免费的知识星球，感兴趣的微信扫码即可加入！</p>
<p><img src="http://image.x-sir.com/zsxq_qrcodezsxq_qrcode.jpg" alt="image"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vance.xin/2019/05/18/RxJava2.x创建操作符之create和just (打怪升级版)！！！/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="程序员飞飞">
      <meta itemprop="description" content="Android、Java Developer.">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员飞飞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/05/18/RxJava2.x创建操作符之create和just (打怪升级版)！！！/" class="post-title-link" itemprop="url">RxJava2.x创建操作符之create和just (打怪升级版)！！！</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-18 14:52:56" itemprop="dateCreated datePublished" datetime="2019-05-18T14:52:56+08:00">2019-05-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-05-22 20:43:51" itemprop="dateModified" datetime="2019-05-22T20:43:51+08:00">2019-05-22</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><img src="http://image.x-sir.com/FktTLU6ea8mEdcLduIBEfTh8ZYdV" alt=""></p>
<p>题图：来自网络</p>
<p>哈喽，朋友们，好久不见了，有段时间没推文了。从今天开始，我将计划更新 RxJava2.x 系列的文章，RxJava 是什么东西，我想也不用给大家介绍了吧。</p>
<p>其实，网上关于 RxJava 的相关文章一大堆，我之前也看过不少，对于新手来说，那些文章，要么就是比较长，不容易看下去，要么就是讲的全是理论，晦涩难懂，缺少实践性。</p>
<p>因此，我打算从今天开始，更新一系列的 RxJava2.x 教程，主要从常用的操作符讲起，目的很简单，带大家每天学会一个操作符的使用。</p>
<p>操作符是 RxJava 的重要组成部分，因此学习操作符也是非常重要的，RxJava 的操作符虽然说比较多，但是我们可以将其进行分类，然后逐一进行理解学习，其实也是比较容易和轻松的，RxJava 的操作符大致可以分为以下几类：</p>
<p><img src="http://image.x-sir.com/FofYPEnQJ_1W2CKeqjO8XHWgakyX" alt=""></p>
<p>今天，我们先来学习两个简单的创建操作符 create &amp; just。</p>
<p>在学习之前，我们先来回顾下观察者模式，大多数同学应该都不陌生吧，例如 Android 的EventBus 等框架都使用了观察者模式，简单说这就是一种发布、订阅的模式，你可以简单理解为订阅报纸。</p>
<p>这与 RxJava 又有什么关系呢？我们先来看下 Rx 的概念：Rx 是一个使用可观察数据流进行异步编程的编程接口，也就是说 RxJava 中使用了观察者模式的这种编程思想，另外还结合了迭代器模式和函数式编程，并把它运用发挥到了极致。</p>
<p>我们都知道观察者模式中，有 3 个重要的概念，被观察者，观察者和订阅，类比到现实中订阅报纸的场景中就是，报纸是被观察者，阅读报纸的人是观察者，人订阅了报纸也就是说使用订阅将他们两者关联起来，这样就形成了一种发布、订阅的关系。</p>
<p>举个例子吧，我们来看看 Android 中点击事件的处理，注意：观察者模式与点击回调模式有很多的相似处，简单对比就是：回调是一对一的关系，只监听一个事件；观察者模式则是一个主题，可以有多个监听者，当主题变化时，向部分或所有监听者发出变化的通知，观察者模式是一对多的关系。</p>
<p><img src="http://image.x-sir.com/FqENsbJlDpDhhbFg7_fllxjBkAsu" alt=""></p>
<p>上面的代码很简单吧，我相信大家都能看得懂，一般我们习惯上将监听器写成匿名的，这里我是为了给大家做类比，所以分开写了，然后我们再结合观察者模式看看上面的代码，第一步实例化一个 Button 就相当于是创建了一个被观察者，第二步初始化一个监听器就相当于是创建了一个观察者，第三步将监听器和 Button 绑定就相当于是把被观察者和观察者通过订阅将他们两者关联起来，是不是理解起来非常简单。</p>
<p>我们再来看看 RxJava 如何来实现，我们就先从最简单的 Hello World 学习起来吧，同样的还是三步走！</p>
<p>第一步，创建被观察者（Observable）<br>第二步，创建观察者（Observer）<br>第三步，将被观察者和观察者绑定（subscribe）</p>
<p><img src="http://image.x-sir.com/FnIeZphHHxbniPktU0LPojPy-uLe" alt=""></p>
<p>和上面的点击事件对比一下，是不是感觉有异曲同工之妙？但是我们习惯上一般不分开写，而是将方法的调用写成链式调用，将对对象写成匿名的对象，我们将上面的代码变换下，如下所示：</p>
<p><img src="http://image.x-sir.com/FhRcbDj6_Pav2DBwUQRLpbMBRJJw" alt=""></p>
<p>我们看到，在上面的创建被观察者的 subscribe 方法中，调用了 onNext 方法，将 “Hello World” 字符串传递下去，而在下面调用 subscribe 的时候，传递了一个 Consumer 对象（观察者），而这个 Consumer 的回调方法就会收到 onNext 的传递过来的值，接着，我们在下面打印了一下 onNext 传递过来的字符串。</p>
<p>实际上，subscribe（订阅）是一个重载方法，它可以接收 0-4 个参数，当传递一个参数时，就代表接收处理成功时的回调（onNext），如传递多个参数则代表接收处理错误、完成、当订阅完成时的事件处理，我们这里为了演示，就只处理成功事件就行了。</p>
<p>上面的代码看着还是不太完美，我们这里使用 just 操作符将它改造一下，just 是什么鬼？看着怎么一脸懵逼，好吧，那就让大飞哥来给你讲解下 just 操作符。</p>
<p>just 操作符和 create 操作符一样，也是创建操作符的一种，just 操作符是将一个或多个对象转换成发射这个或这些对象的一个 Observable，看完概念还是一脸懵逼怎么办？确实，这些概念是比较抽象的，其实，用起来特别简单，当你会用了之后，你再回过头去理解起来会容易很多。</p>
<p>来继续将我们的 Hello World 用 just 操作符改造一下：</p>
<p><img src="http://image.x-sir.com/FqctUFNUoi_pT5I0QQX4Q1R99LdF" alt=""></p>
<p>怎么样，是不是更简单了，我们点开 just 方法，我们看到它接收的是一个 T，也就是说它可以接收任意类型的参数，我们以后就可以使用 just 操作符来很方便的创建各种被观察者对象了，非常棒！我们又学会了一个操作符，欧耶！</p>
<p>上面的代码看着还是有点长，我们可以用 Lambda 表达式改造一下看看：</p>
<p><img src="http://image.x-sir.com/FlGPbco53npYjS-AkQ4jxKwoQfJx" alt=""></p>
<p>哇哦！It’s beautiful! 一行代码就搞定了，有木有？</p>
<p>至此，我们今天的学习目标就算达成了，感觉是不是很简单，很轻松？</p>
<p>如果你学会了就赶紧动手去实践一下吧，实践是检验真理的唯一标准，眼过千遍不如手过一遍，代码是用来敲的不是用来看的，希望我们程序员都是实干家！</p>
<p>今天的内容确实比较轻松和简单，后面还有更大的挑战呢，从今天开始，大飞哥将带你一起打怪升级练本领，一起去闯关，去战斗！大家敬请期待吧！</p>
<p>最后，引用大飞哥的一句名言作为结尾吧：“是兄弟，就一起去战斗吧！”</p>
<p>Ps:扫描下面的二维码，关注「IT大飞说」，回复「加群」，拉你进入兄弟战斗群，最后告诉你们一个小秘密，公号对话框回复「装备01」 送你一件珍藏版的打怪装备，战斗力瞬间可增加 80！！！我使用过，效果杠杠滴！从此，我们就可以一起愉快的装逼了！</p>
<p>飞哥带你去装逼，一直装逼到天黑！</p>
<p>更多干货文章请关注我的微信公众号：<br><img src="https://img-blog.csdn.net/20180626144909992?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbnBlbmdmZWk1MjE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="扫一扫关注"></p>
<p>另外，我还建了一个免费的知识星球，感兴趣的微信扫码即可加入！</p>
<p><img src="http://image.x-sir.com/zsxq_qrcodezsxq_qrcode.jpg" alt="image"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vance.xin/2019/01/30/你不知道的 Gradle 技巧/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="程序员飞飞">
      <meta itemprop="description" content="Android、Java Developer.">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员飞飞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/01/30/你不知道的 Gradle 技巧/" class="post-title-link" itemprop="url">你不知道的 Gradle 高级技巧（一）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2019-01-30 14:52:30 / 修改时间：14:52:57" itemprop="dateCreated datePublished" datetime="2019-01-30T14:52:30+08:00">2019-01-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>作为一名Android 开发者，我们都有发布 APP 内测版本的经历，有的公司是发布到自己的服务器上，生成一个连接或者二维码扫描就可以下载，有的公司使用一些内测平台如蒲公英、fir.im 等，有这么好的内测平台为什么不用呢？一方面这些平台的基本都是免费提供服务的，另外一方面也提供了许多丰富的 api，方便开发者使用，提升效率！</p>
</blockquote>
<h2 id="1"><a href="#1" class="headerlink" title="1."></a><em>1.</em></h2><p>前段时间研究 Android 端的自动打包，采用的是 Jenkins + Git 的方式，这样，当你 push 完代码之后，Jenkins 会自动拉取你的代码，然后再用 Gradle 工具进行自动化打包，Jenkins 可以配置许多插件，当打包完之后可以自动上传到蒲公英和 fir.im 等平台，特别方便，基本就是这么个流程，我们之前公司是运维帮我们在服务器端搭建的自动打包程序，这样的好处是当你需要打几十个包时，特别快，因为服务器的配置一般比电脑都高，并且不用占用自己电脑的资源。我自己前段时间也在自己的电脑上装了一个 Jenkins，然后一些配置，也可以进行自动化打包，但是我觉得没必要，因为你把代码 push 上去，然后再拉下来，然后再打包，用的还是你本地电脑的资源，还不如直接用 AS 打包来的快，我看了下 Jenkins 上传到公测平台的实现，其实就是用了一个 <code>curl</code> 命令来实现的，我就想着能不能在 <strong>Gradle</strong> 中配置上传的脚本？答案当然是可以的！</p>
<h2 id="2"><a href="#2" class="headerlink" title="2."></a><em>2.</em></h2><p>首先，我们了解下什么是 curl？</p>
<p>下面的概念来自某度的解释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl 命令是一个利用 URL 规则在命令行下工作的文件传输工具。它支持文件的上传和下载，所以是综合传输工具，但按传统，习惯称 curl 为下载工具。作为一款强力工具，curl 支持包括 HTTP、HTTPS、ftp 等众多协议，还支持 POST、cookies、认证、从指定偏移处下载部分文件、用户代理字符串、限速、文件大小、进度条等特征。</span><br></pre></td></tr></table></figure>
<p>简单说他就是一个命令，Linux 和 Mac 系统自带，Windows 需要安装 curl 才能使用，在哪里下载 curl?为了方便大家我已经帮大家下载好了，复制下面的字符发送到后台即可：</p>
<center><strong>curl</strong></center>

<p>里面包含 32 位 &amp; 64 位的安装程序，还有安装教程的链接供大家参考，安装完成后需要配置环境变量，然后在 cmd 中输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl --version</span><br></pre></td></tr></table></figure>
<p>如果显示 curl 的版本号说明安装成功了~</p>
<h2 id="3"><a href="#3" class="headerlink" title="3."></a><em>3.</em></h2><p>有了 curl 命令，我们就可以执行 curl 命令来进行上传文件了，我们先看下蒲公英上传 apk 的接口文档，如下图：</p>
<p><img src="https://img-blog.csdnimg.cn/20190130093717762.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbnBlbmdmZWk1MjE=,size_16,color_FFFFFF,t_70" alt="image"></p>
<p>其中，_api_key、uKey 和 file 字段是必须的，其他参数都是可选项，_api_key 和 uKey 蒲公英都会为每个 APP 自动分配一个，在你的蒲公英账号对应的 APP 的信息中可以找到，file 参数就是要上传的文件了，为了让我们上传的 APP 有每次更新的描述，我们还需要添加一个 buildUpdateDescription 字段，这样，每次上传 APP 之后就可以显示本次更新的描述信息了。</p>
<p>文档看完之后，我们需要使用 curl 命令来发送一个上传文件的 POST 请求，url 的语法如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl(选项)(参数)</span><br></pre></td></tr></table></figure>
<p><img src="https://img-blog.csdnimg.cn/20190130093812715.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbnBlbmdmZWk1MjE=,size_16,color_FFFFFF,t_70" alt="image"></p>
<p>curl 命令的选项有很多，上图只是截取了其中的一部分，根据蒲公英上传 APP 的接口文档，提交的是 multipart/form-data 类型的数据，因此我们使用 -F 选项，我们可以写出伪命令了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -F 参数1 -F 参数2 -F 参数3 接口地址</span><br></pre></td></tr></table></figure>
<p>因为我们上传 APP 需要 3 个参数，所以这里也需要三个参数，后面再加上我们请求的接口地址就可以了，这应该很好理解吧？</p>
<p>我们再把参数部分替换成真实的的参数，完整的命令如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -F &quot;file=app/build/outputs/apk/release/release-v1.0.apk&quot; -F &quot;uKey=ce0e825125bfe666762b2a93feb7de00&quot; -F &quot;_api_key=534a49154990d8e9126918fbdbee600a&quot; -F &quot;buildUpdateDescription=bugs fix!&quot; https://www.pgyer.com/apiv2/app/upload</span><br></pre></td></tr></table></figure>
<p>好了，一条完整的 curl 上传命令算是完成了，其中，-F 后面的参数是字段名和参数的值，中间用 “=” 号进行连接，然后我们打开 AS 的 Terminal，执行上面的命令即可进行上传 apk 到蒲公英，上传过程也有进度显示，如果显示 100%，说明上传成功了，注意上面的 uKey 和 _api_key 的值换成你自己的，另外也要注意你打完包的 apk 文件路径要真实存在，否则会出现异常！</p>
<h2 id="4"><a href="#4" class="headerlink" title="4."></a><em>4.</em></h2><p>上面我们已经学会了使用 curl 命令上传我们的 apk 了，但是你们有没有发现，我们每次上传 apk 需要好几步：</p>
<ul>
<li>打包 apk；</li>
<li>修改上传命令中 apk 的文件名和描述信息；</li>
<li>复制 curl 命令到 Terminal 中执行；</li>
<li>…</li>
</ul>
<p>至少需要 3 步才能完成，这也是一件非常麻烦的事情，作为程序员，都是比较懒的，与其说懒不如说是机智，避免做浪费时间的事情，我再想，能不能一条命令一步到位呢？当然是可以的。</p>
<p>我们先进行改造上传命令的第一步，先把 curl 命令中 file 的值，也就是 apk 路径动态进行获取，这样就不用每次都去修改了，我们知道 gradle 语法中的字符串有两种，一种是单引号，另一种是双引号，区别就是，双引号支持插值，这样我们就可以写一个方法，这个方法的作用就是获取打包好的 apk 的全路径，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">def getApkFullPath() &#123;</span><br><span class="line">    return rootDir.getAbsolutePath() + &quot;/app/build/outputs/apk/release/&quot; + getApkName()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">def getApkName() &#123;</span><br><span class="line">    return &quot;update-app-example-v$&#123;android.defaultConfig.versionName&#125;-$&#123;releaseTime()&#125;.apk&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">static def releaseTime() &#123;</span><br><span class="line">    return new Date().format(&quot;yyyy-MM-dd&quot;, TimeZone.getTimeZone(&quot;UTC&quot;))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面总共有 3 个方法，也比较简单，大家应该都能看得懂，就不过多解释了，其中第一个方法中的 <code>rootDir.getAbsolutePath()</code> 说一下，它可以获取你当前项目在你本地电脑的全路径。</p>
<p>方法写好了，我们还需要把打包脚本稍微修改下，具体如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">release &#123;</span><br><span class="line">            minifyEnabled false</span><br><span class="line">            proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class="line">            signingConfig signingConfigs.release</span><br><span class="line">            android.applicationVariants.all &#123; variant -&gt;</span><br><span class="line">                variant.outputs.all &#123;</span><br><span class="line">                    outputFileName = getApkName()</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>注意看上面的 <code>outputFileName = getApkName()</code>，这样写每次生成的 apk 的名字就是我们要获取的 apk 的文件名，这样每次打包完后我们都能获取到打包完后的 apk 的文件名了！这样，我们 curl 上传命令中动态获取 apk 文件路径这个问题就算解决了，我们再看下我们的 curl 命令中还有 uKey 和 _api_key 两个参数，因为这两个值属于比较私密的东西我们一般都是配置到 <code>local.properties</code> 文件中，然后动态读取的，git 默认是忽略提交 <code>local.properties</code> 文件的，这样防止自己的私密信息被提交和泄露出去，因此，这里也写个方法动态读取一下吧：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def readProperties(key) &#123;</span><br><span class="line">    File file = rootProject.file(&apos;local.properties&apos;)</span><br><span class="line">    if (file.exists()) &#123;</span><br><span class="line">        InputStream inputStream = rootProject.file(&apos;local.properties&apos;).newDataInputStream()</span><br><span class="line">        Properties properties = new Properties()</span><br><span class="line">        properties.load(inputStream)</span><br><span class="line"></span><br><span class="line">        if (properties.containsKey(key)) &#123;</span><br><span class="line">            return properties.getProperty(key)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个方法也比较简单，相信大家都能看的明白！</p>
<p>现在我们的上传命令中还有一个字段 <code>buildUpdateDescription</code>，更新描述信息，每次上传 apk 都需要修改一下更新的描述，直接在命令中修改，也不太好，因此我们也写个方法动态获取吧，如下所示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">static def getUpdateDescription() &#123;</span><br><span class="line">    return &apos;1.修复一些bug；\n2.提升用户体验！&apos;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码，非常简单，一目了然，只要是程序员都能看得懂，如果你看不懂，说明你是伪程序员！</p>
<p>好了，终于完成了，我们最终上传的命令被改造成了这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -F &quot;file=@$&#123;getApkFullPath()&#125;&quot; -F &quot;uKey=$&#123;readProperties(&apos;pgyer.userKey&apos;)&#125;&quot; -F &quot;_api_key=$&#123;readProperties(&apos;pgyer.apiKey&apos;)&#125;&quot; -F &quot;buildUpdateDescription=$&#123;getUpdateDescription()&#125;&quot; https://www.pgyer.com/apiv2/app/upload</span><br></pre></td></tr></table></figure>
<h2 id="5"><a href="#5" class="headerlink" title="5."></a><em>5.</em></h2><p>上面的命令算是改造完成了，不知道你们有没有发现，有个致命的问题就是，这条命令怎么执行啊？因为我么你的命令中动态调用了 Gradle 中我们写的方法，直接在 Terminal 中执行肯定是会报错的！这可就尴尬了。。我们想了想，要想让我们上传命令中的方法能够被成功调用，这个命令和被调用的方法肯定是在同一个 Gradle 文件中的，我们再想能不能写一个 Task，这这个 Task 中执行我们的上传命令，这样不就解决问题了吗？嗯，想了想是可以的，我发现在写的过程中 Task 好写，但是我们这个命令怎么才能够执行呢？肯定也需要一个东西才能执行我们的命令，搜了下，Gradle 中有个 <code>exec</code> 东西，它可以执行一条具体的 bash 命令，嗯，灰常不错，可以的，very good!真香！最终我们写的完整的 Task 如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">task(&quot;uploadApk&quot;) &#123;</span><br><span class="line">        def command = &quot;curl -F \&quot;file=@$&#123;getApkFullPath()&#125;\&quot; -F \&quot;uKey=$&#123;readProperties(&apos;pgyer.userKey&apos;)&#125;\&quot; -F \&quot;_api_key=$&#123;readProperties(&apos;pgyer.apiKey&apos;)&#125;\&quot; -F \&quot;buildUpdateDescription=$&#123;getUpdateDescription()&#125;\&quot; https://www.pgyer.com/apiv2/app/upload&quot;</span><br><span class="line">        println &quot;command:&quot; + command</span><br><span class="line">        try &#123;</span><br><span class="line">            exec &#123;</span><br><span class="line">                ExecSpec execSpec -&gt;</span><br><span class="line">                    executable &apos;bash&apos;</span><br><span class="line">                    args &apos;-c&apos;, command</span><br><span class="line">            &#125;</span><br><span class="line">            println &quot;uploadApk success~&quot;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace()</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码相对也比较简单，其中 <code>ExecSpec</code> 大家可能看着比较陌生，executable ‘bash’ 为固定写法，其中 bash 代表 shell 的类型，Linux 下有很多种 shell 的类型，流行的 shell 有 ash、bash、ksh、csh、zsh 等，一般我们常用的都是 bash，其中的 command 就是一条具体的命令了。</p>
<p>这样，我们只要执行这个 Task 就可以自动执行上传命令并动态获取我们所需要的参数了~</p>
<h2 id="6"><a href="#6" class="headerlink" title="6."></a><em>6.</em></h2><p>上面的命令执行起来是非常方便的，但是在实际使用中，我们发现，需要先打完包之后才能执行上传的 Task，我们知道 Gradle 中的 Task 是可以依赖另一个 Task 的，打包命令实质上也是一个 Task，这样我们让我们自己写的 Task 依赖于打包的 Task 不就行了吗？我觉得没毛病，这样，当执行完打包后，自动执行上传命令，这样一条命令就可以解决问题，另外，我们自己的 Task 也需要稍微修改下，将上传的实现部分放到 <code>doLast</code> 闭包中，完成代码入下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">task(&quot;uploadApk&quot;) &#123;</span><br><span class="line">    doLast &#123;</span><br><span class="line">        def command = &quot;curl -F \&quot;file=@$&#123;getApkFullPath()&#125;\&quot; -F \&quot;uKey=$&#123;readProperties(&apos;pgyer.userKey&apos;)&#125;\&quot; -F \&quot;_api_key=$&#123;readProperties(&apos;pgyer.apiKey&apos;)&#125;\&quot; -F \&quot;buildUpdateDescription=$&#123;getUpdateDescription()&#125;\&quot; https://www.pgyer.com/apiv2/app/upload&quot;</span><br><span class="line">        println &quot;command:&quot; + command</span><br><span class="line">        try &#123;</span><br><span class="line">            exec &#123;</span><br><span class="line">                ExecSpec execSpec -&gt;</span><br><span class="line">                    executable &apos;bash&apos;</span><br><span class="line">                    args &apos;-c&apos;, command</span><br><span class="line">            &#125;</span><br><span class="line">            println &quot;uploadApk success~&quot;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">uploadApk.dependsOn(&quot;assembleRelease&quot;)</span><br></pre></td></tr></table></figure>
<p>从此，我们只要在 Terminal 中执行一条命令就可以实现打包上传了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./gradlew uploadApk</span><br></pre></td></tr></table></figure>
<p>温馨提示：Windows 用户执行命令不需要加 ./</p>
<p>怎么样？是不是很爽！这个效率上的提升不是一点半点，后续我再想能不能把这个功能封装成一个 Gradle 插件的形式，提供给大家使用，这样也许是要添加一两行代码引用一下插件的就可以使用了，这样就更加方便了，敬请期待吧~</p>
<p>如果我的文章对你有用，欢迎留言！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vance.xin/2019/01/08/一行代码实现蒲公英市场APP检查更新/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="程序员飞飞">
      <meta itemprop="description" content="Android、Java Developer.">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员飞飞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/01/08/一行代码实现蒲公英市场APP检查更新/" class="post-title-link" itemprop="url">一行代码实现蒲公英市场APP检查更新</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-01-08 22:40:00" itemprop="dateCreated datePublished" datetime="2019-01-08T22:40:00+08:00">2019-01-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-01-09 22:41:06" itemprop="dateModified" datetime="2019-01-09T22:41:06+08:00">2019-01-09</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>我们知道，只要是个 APP 就都有更新的功能，可以说这个功能是比较重要的功能，我们在上架之前都会发布测试的版本，测试一般都是发布到蒲公英、Fir.im 等平台，可以说这个需求也算是比较普遍的一个功能了，之前我们的 APP 用的是蒲公英公测，然后现在又有一个新的 APP 需要，这就需要把之前的更新功能重写一遍，其实这是比较麻烦的，也没有必要，我想着能不能把这个功能抽取出来，于是就有了今天这个库。</p>
</blockquote>
<h2 id="1-实现思路"><a href="#1-实现思路" class="headerlink" title="1.实现思路"></a>1.实现思路</h2><p>其实，要实现这个功能也比较简单，第一步，我先是判断是否有读写外部存储的权限，因为下载 apk 一般来说是要下载到手机的 SD 卡上；如果有权限，那就调用蒲公英的更新检测接口，这个接口至少需要两个参数，apiKey 和 appKey，这两个值我们在蒲公英的 APP 信息中可以查到，我的想法是在清单文件中，让用户去设置这两个值，然后我动态取出来，这样就解决了这两个参数值传递的问题；接口请求成功后，会返回 buildVersionNo这个字段，然后通过这个返回字段与本地的 versionCode 去比对，如果比本地的大，说明就有新版本，然后弹出对话框，提示用户更新，当用户点击“更新”时，就去下载对应的版本即可，下载完成后调用安装程序，这样基本的更新思路就出来了。</p>
<h2 id="2-使用方式"><a href="#2-使用方式" class="headerlink" title="2.使用方式"></a>2.使用方式</h2><p>使用方式也比较简单，我已经将库发布到 jCenter 上了，大家查看项目的主页即可：</p>
<p><a href="https://github.com/xinpengfei520/pgyer-android-app-update" target="_blank" rel="noopener">https://github.com/xinpengfei520/pgyer-android-app-update</a></p>
<p>如果你觉得有帮助的话，请帮我点个 star，谢谢！另外，欢迎大家 fork 和 PR。</p>
<p>温馨提示：<br>点击查看原文可以看到项目的主页。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vance.xin/2018/12/27/BaseRecyclerViewAdapterHelper/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="程序员飞飞">
      <meta itemprop="description" content="Android、Java Developer.">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员飞飞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/12/27/BaseRecyclerViewAdapterHelper/" class="post-title-link" itemprop="url">BaseRecyclerViewAdapterHelper 让 RecyclerView 用起来更爽</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2018-12-27 17:10:57 / 修改时间：17:13:01" itemprop="dateCreated datePublished" datetime="2018-12-27T17:10:57+08:00">2018-12-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>BaseRecyclerViewAdapterHelper 是 GitHub 上的一个开源库，它可以让 RecyclerView 的使用更简单，方便和清晰，和原始的 adapter 相比，减少 70% 的代码量。确实，我最近的项目中也集成了这个库，并把之前的所有的 Adapter 都替换了为了库中的实现方式，代码量减少了，逻辑也更加清晰了，减少了一些无用功，提高了开发效率！强烈推荐大家使用。</p>
</blockquote>
<p>这个库也算封装的很好了，正常情况下，可以满足大部分的开发需求，其主要有一下几大优点：</p>
<ol>
<li>支持设置各种加载动画；</li>
<li>支持添加多个头和多个尾布局；</li>
<li>支持自动加载和预加载；</li>
<li>支持分组布局；</li>
<li>支持树形结构，也就是我们常说的折叠分组效果；</li>
<li>支持多种数据类型及多种布局的实现效果；</li>
<li>支持设置数据为空时的布局；</li>
<li>支持侧滑刷新和拖拽动作；</li>
<li>支持下拉刷新和加载更多；</li>
<li>支持自定义 ViewHolder；</li>
<li>更多请自行去发现…</li>
</ol>
<p>开源库地址：<a href="https://github.com/CymChad/BaseRecyclerViewAdapterHelper" target="_blank" rel="noopener">https://github.com/CymChad/BaseRecyclerViewAdapterHelper</a></p>
<p>开源库中文文档：<a href="https://www.jianshu.com/p/b343fcff51b0" target="_blank" rel="noopener">https://www.jianshu.com/p/b343fcff51b0</a></p>
<p>官方网站：<a href="http://www.recyclerview.org/" target="_blank" rel="noopener">http://www.recyclerview.org/</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vance.xin/2018/11/06/绘制一个漂亮的弧形 View/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="程序员飞飞">
      <meta itemprop="description" content="Android、Java Developer.">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员飞飞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2018/11/06/绘制一个漂亮的弧形 View/" class="post-title-link" itemprop="url">绘制一个漂亮的弧形 View</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-06 11:28:01" itemprop="dateCreated datePublished" datetime="2018-11-06T11:28:01+08:00">2018-11-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-12-08 23:02:48" itemprop="dateModified" datetime="2018-12-08T23:02:48+08:00">2018-12-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>来，先看下效果图：</p>
<p><img src="http://pcobk8jbf.bkt.clouddn.com/FjVEV1HKnkl637u0Qs7im1YRfBjo" alt=""></p>
<p>怎么样？漂亮吧，上面是一个标题栏，下面是一个弧形的 View，标题栏和弧形 View 从左到右都有一个线性的渐变色，类似于手机 QQ 顶部的渐变效果，关于弧形的这种效果，使用的场景还是比较普遍的，小面我们就一起来看看如何绘制吧。</p>
<h2 id="1-先自定义一个-ArcView"><a href="#1-先自定义一个-ArcView" class="headerlink" title="1.先自定义一个 ArcView"></a>1.先自定义一个 ArcView</h2><p>创建一个类 ArcView 继承于 View，然后我们重写其三个构造方法，还有 onMeasure() 和 onDraw() 方法，这都是自定义 View 最基本的写法，比较简单这里就不详细说了， onMeasure() 用于测量 View 的宽高尺寸，onDraw() 就是具体的绘制过程了，具体的绘制思路是：我们在 onMeasure（）方法中拿到测量出来的宽和高，然后再 onDraw() 中初始化一个画笔，我们可以创建一个 LinearGradient 对象，然后调用设置画笔的 setShader() 方法就可以达到画笔渐变色的效果，然后再创建一个 Rect 对象，这里只是创建了一个矩形对象，要想绘制弧形，我们还需要设置绘制的路径，创建一个 Path 对象，分别调用 moveTo() 方法，和 quadTo() 方法，moveTo （）不会进行绘制，只用于移动移动画笔，一般和其他方法配合使用，这里和 quadTo() 方法配合使用，而 quadTo() 用于绘制圆滑的曲线，即贝塞尔曲线。mPath.quadTo(x1, y1, x2, y2) 其中x1、y1 为控制点，x2、y2 为结束点。有了路径之后我们就可以轻而易举地绘制出一个弧形了，完整的代码请看下面：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by x-sir on 2018/8/10 :)</span><br><span class="line"> * Function:自定义弧形 View</span><br><span class="line"> */</span><br><span class="line">public class ArcView extends View &#123;</span><br><span class="line"></span><br><span class="line">    private int mWidth;</span><br><span class="line">    private int mHeight;</span><br><span class="line">    private int mArcHeight; // 弧形高度</span><br><span class="line">    private int mBgColor; // 背景颜色</span><br><span class="line">    private Paint mPaint;</span><br><span class="line"></span><br><span class="line">    public ArcView(Context context) &#123;</span><br><span class="line">        this(context, null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ArcView(Context context, @Nullable AttributeSet attrs) &#123;</span><br><span class="line">        this(context, attrs, 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public ArcView(Context context, @Nullable AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        super(context, attrs, defStyleAttr);</span><br><span class="line">        TypedArray typedArray = context.obtainStyledAttributes(attrs, R.styleable.ArcView);</span><br><span class="line">        mArcHeight = typedArray.getDimensionPixelSize(R.styleable.ArcView_arcHeight, 0);</span><br><span class="line">        mBgColor = typedArray.getColor(R.styleable.ArcView_bgColor, Color.parseColor(&quot;#1E90FF&quot;));</span><br><span class="line">        typedArray.recycle();</span><br><span class="line">        mPaint = new Paint();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @SuppressLint(&quot;DrawAllocation&quot;)</span><br><span class="line">    @Override</span><br><span class="line">    protected void onDraw(Canvas canvas) &#123;</span><br><span class="line">        super.onDraw(canvas);</span><br><span class="line">        // 参数一为渐变起初点坐标 x 位置，参数二为 y 轴位置，参数三和四分辨对应渐变终点，最后参数为平铺方式，这里设置为镜像</span><br><span class="line">        LinearGradient lg = new LinearGradient(0, 0, mWidth, 0,</span><br><span class="line">                Color.parseColor(&quot;#4796FB&quot;), Color.parseColor(&quot;#5AB4F9&quot;),</span><br><span class="line">                Shader.TileMode.CLAMP);</span><br><span class="line">        // 刚才已经讲到 Gradient 是基于 Shader 类，所以我们通过 Paint 的 setShader 方法来设置这个渐变</span><br><span class="line">        mPaint.setShader(lg);</span><br><span class="line">        mPaint.setStyle(Paint.Style.FILL);</span><br><span class="line">        //mPaint.setColor(mBgColor);</span><br><span class="line">        mPaint.setAntiAlias(true);</span><br><span class="line">        Rect rect = new Rect(0, 0, mWidth, mHeight - mArcHeight);</span><br><span class="line">        canvas.drawRect(rect, mPaint);</span><br><span class="line">        Path path = new Path();</span><br><span class="line">        path.moveTo(0, mHeight - mArcHeight);</span><br><span class="line">        path.quadTo(mWidth / 2, mHeight, mWidth, mHeight - mArcHeight);</span><br><span class="line">        canvas.drawPath(path, mPaint);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onMeasure(int widthMeasureSpec, int heightMeasureSpec) &#123;</span><br><span class="line">        super.onMeasure(widthMeasureSpec, heightMeasureSpec);</span><br><span class="line">        int widthSize = MeasureSpec.getSize(widthMeasureSpec);</span><br><span class="line">        int widthMode = MeasureSpec.getMode(widthMeasureSpec);</span><br><span class="line">        int heightSize = MeasureSpec.getSize(heightMeasureSpec);</span><br><span class="line">        int heightMode = MeasureSpec.getMode(heightMeasureSpec);</span><br><span class="line"></span><br><span class="line">        if (widthMode == MeasureSpec.EXACTLY) &#123;</span><br><span class="line">            mWidth = widthSize;</span><br><span class="line">        &#125;</span><br><span class="line">        if (heightMode == MeasureSpec.EXACTLY) &#123;</span><br><span class="line">            mHeight = heightSize;</span><br><span class="line">        &#125;</span><br><span class="line">        setMeasuredDimension(mWidth, mHeight);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我这里只定义了弧形的高度和背景颜色这两个自定义属性，其中还有渐变颜色的开始色值和结束色值，还有是否需要渐变等属性，都可以定义为自定义的属性，方便直接在布局文件中灵活进行配置，以适应不同的需求，也比较简单，我这里为了就不实现了。</p>
<h2 id="2-自定义一个通用的-titlebar"><a href="#2-自定义一个通用的-titlebar" class="headerlink" title="2.自定义一个通用的 titlebar"></a>2.自定义一个通用的 titlebar</h2><p>这样做我们可以提高代码的复用性，可以将一些功能封装进去，也更好地体现了封装的思想，实现也比较简单，使用 LayoutInflater 加载了一个布局文件，然后将 文字，字体大小，字体颜色和 title 背景色等定义成了自定义的属性，方便在布局文件中进行设置，另外我们内部默认处理了点击返回按钮的事件，对于需要其他特殊情况下返回按钮的处理，我们也定义了一个接口，方便外部使用接口来自行进行处理，代码也非常简单，看下面：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by x-sir on 2018/9/2 :)</span><br><span class="line"> * Function:自定义通用 TitleBar</span><br><span class="line"> */</span><br><span class="line">public class TitleBarLayout extends LinearLayout &#123;</span><br><span class="line"></span><br><span class="line">    private ImageView ivBack;</span><br><span class="line">    private ImageView ivMenu;</span><br><span class="line">    private TextView tvTitleName;</span><br><span class="line">    private LinearLayout llTitleBg;</span><br><span class="line">    private CharSequence mText;</span><br><span class="line">    private int mTitleBgColor;</span><br><span class="line">    private boolean mMenuVisible;</span><br><span class="line">    private int mTextSize;</span><br><span class="line">    private int mTextColor;</span><br><span class="line">    private OnMenuClickListener mListener;</span><br><span class="line">    private OnBackClickListener mOnBackListener;</span><br><span class="line">    private static final String DEFAULT_TEXT = &quot;Title&quot;; // default text.</span><br><span class="line">    private static final int DEFAULT_TEXT_SIZE = 16; // default text size.</span><br><span class="line">    private static final String TAG = &quot;TitleBarLayout&quot;;</span><br><span class="line"></span><br><span class="line">    public TitleBarLayout(Context context) &#123;</span><br><span class="line">        this(context, null);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public TitleBarLayout(Context context, @Nullable AttributeSet attrs) &#123;</span><br><span class="line">        this(context, attrs, 0);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public TitleBarLayout(Context context, @Nullable AttributeSet attrs, int defStyleAttr) &#123;</span><br><span class="line">        super(context, attrs, defStyleAttr);</span><br><span class="line"></span><br><span class="line">        TypedArray typedArray = context.obtainStyledAttributes(attrs, R.styleable.TitleBarLayout);</span><br><span class="line">        mText = typedArray.getText(R.styleable.TitleBarLayout_text);</span><br><span class="line">        mTextSize = typedArray.getDimensionPixelSize(R.styleable.TitleBarLayout_textSize, DEFAULT_TEXT_SIZE);</span><br><span class="line">        mTextColor = typedArray.getColor(R.styleable.TitleBarLayout_textColor, Color.parseColor(&quot;#FFFFFF&quot;));</span><br><span class="line">        mTitleBgColor = typedArray.getColor(R.styleable.TitleBarLayout_titleBgColor, Color.parseColor(&quot;#1E90FF&quot;));</span><br><span class="line">        mMenuVisible = typedArray.getBoolean(R.styleable.TitleBarLayout_menuVisible, false);</span><br><span class="line">        typedArray.recycle();</span><br><span class="line"></span><br><span class="line">        initView(context);</span><br><span class="line">        initData();</span><br><span class="line">        initListener();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void initView(Context context) &#123;</span><br><span class="line">        LayoutInflater.from(context).inflate(R.layout.common_titlebar, this);</span><br><span class="line">        ivBack = findViewById(R.id.ivBack);</span><br><span class="line">        ivMenu = findViewById(R.id.ivMenu);</span><br><span class="line">        tvTitleName = findViewById(R.id.tvTitleName);</span><br><span class="line">        llTitleBg = findViewById(R.id.llTitleBg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void initData() &#123;</span><br><span class="line">        String text = (mText != null) ? mText.toString() : DEFAULT_TEXT;</span><br><span class="line">        tvTitleName.setText(text);</span><br><span class="line">        tvTitleName.setTextSize(TypedValue.COMPLEX_UNIT_PX, mTextSize);</span><br><span class="line">        tvTitleName.setTextColor(mTextColor);</span><br><span class="line">        //llTitleBg.setBackgroundColor(mTitleBgColor);</span><br><span class="line">        ivMenu.setVisibility(mMenuVisible ? VISIBLE : INVISIBLE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private void initListener() &#123;</span><br><span class="line">        ivBack.setOnClickListener(v -&gt; &#123;</span><br><span class="line">            // 如果监听器不为空就让其自己处理，为空就默认处理（销毁页面）</span><br><span class="line">            if (mOnBackListener != null) &#123;</span><br><span class="line">                mOnBackListener.onClick();</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                ((Activity) getContext()).finish();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        ivMenu.setOnClickListener(v -&gt; &#123;</span><br><span class="line">            if (mListener != null) &#123;</span><br><span class="line">                mListener.onClick();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setTitleName(String title) &#123;</span><br><span class="line">        if (!TextUtils.isEmpty(title)) &#123;</span><br><span class="line">            tvTitleName.setText(title);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            Log.e(TAG, &quot;set title name failed, because title is null!&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setOnMenuListener(OnMenuClickListener mListener) &#123;</span><br><span class="line">        this.mListener = mListener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setOnBackListener(OnBackClickListener mOnBackListener) &#123;</span><br><span class="line">        this.mOnBackListener = mOnBackListener;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public interface OnMenuClickListener &#123;</span><br><span class="line">        void onClick();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public interface OnBackClickListener &#123;</span><br><span class="line">        void onClick();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>因为这里为了和绘制的弧形协调，我将 title 布局的背景设置了一个渐变的 shape 。</p>
<h2 id="3-将布局延伸到系统状态栏"><a href="#3-将布局延伸到系统状态栏" class="headerlink" title="3.将布局延伸到系统状态栏"></a>3.将布局延伸到系统状态栏</h2><p>Android 5.0 之后我们可以设置 Activity 的布局延伸到系统状态栏中，这样我们页面看起来更美观和协调，设置也比较简单，直接贴代码了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        getWindow().addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);</span><br><span class="line">        getWindow().addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_NAVIGATION);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>另外在布局文件中也可以设置，只需在你 App 引用的主题中添加一行代码即可：</p>
<p><img src="http://pcobk8jbf.bkt.clouddn.com/FtLpSwRRbekR_PbI6n24DXvRqM8m" alt=""></p>
<p>注意：因为这个属性是 5.0 之后才有的，在实际开发中需要做兼容处理，代码中设置时需要判断一下版本，布局文件中可以新建一个 values-v21 文件夹做兼容处理。</p>
<p>如果你的 title 的文字跑到状态栏里了，那样会很丑，在 title 布局的根标签中添加下面一行代码就可以了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:fitsSystemWindows=&quot;true&quot;</span><br></pre></td></tr></table></figure>
<p>这行代码的意思就是不占用系统状态栏的空间。</p>
<p>好了，所有绘制工作都已经完成了，是不是非常简单呢？如果觉得不错的话，欢迎点赞、评论和转发，你们的支持是我坚持不懈的动力！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">程序员飞飞</p>
  <div class="site-description" itemprop="description">Android、Java Developer.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">95</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">129</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">程序员飞飞</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/muse.js"></script>
<script src="/js/next-boot.js"></script>



  















  

  

<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":110,"height":180},"mobile":{"show":false},"log":false,"tagMode":false});</script></body>
</html>
