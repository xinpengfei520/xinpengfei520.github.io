<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.8.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.vance.xin","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Android、Java Developer.">
<meta name="keywords" content="Android Java Program Code 编程 面试 职场">
<meta property="og:type" content="website">
<meta property="og:title" content="程序员飞飞">
<meta property="og:url" content="https://www.vance.xin/page/9/index.html">
<meta property="og:site_name" content="程序员飞飞">
<meta property="og:description" content="Android、Java Developer.">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="程序员飞飞">
<meta name="twitter:description" content="Android、Java Developer.">

<link rel="canonical" href="https://www.vance.xin/page/9/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Android Java Program Code 编程 面试 职场 - 程序员飞飞Android、Java Developer. </title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
  <a href="https://github.com/xinpengfei520" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">程序员飞飞</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">码农，产品思维实践者，终身学习者，微信公众号：「程序员飞飞」。</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="calendar fa-fw"></i>日程表</a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="sitemap fa-fw"></i>站点地图</a>

  </li>
        <li class="menu-item menu-item-baidusitemap">

    <a href="/baidusitemap.xml" rel="section"><i class="sitemap fa-fw"></i>baidusitemap</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="heartbeat fa-fw"></i>公益 404</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vance.xin/2017/09/24/Android OTG之USB转串口模块通讯/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="程序员飞飞">
      <meta itemprop="description" content="Android、Java Developer.">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员飞飞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/09/24/Android OTG之USB转串口模块通讯/" class="post-title-link" itemprop="url">Android OTG 之 USB 转串口模块通讯</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-24 23:47:57" itemprop="dateCreated datePublished" datetime="2017-09-24T23:47:57+08:00">2017-09-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-12-08 23:11:16" itemprop="dateModified" datetime="2018-12-08T23:11:16+08:00">2018-12-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          
            <span id="/2017/09/24/Android OTG之USB转串口模块通讯/" class="post-meta-item leancloud_visitors" data-flag-title="Android OTG 之 USB 转串口模块通讯" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2017/09/24/Android OTG之USB转串口模块通讯/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/09/24/Android OTG之USB转串口模块通讯/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>微信公众号：CodingAndroid<br>CSDN：<a href="http://blog.csdn.net/xinpengfei521" target="_blank" rel="noopener">http://blog.csdn.net/xinpengfei521</a></p>
</blockquote>
<h2 id="1-背景简介"><a href="#1-背景简介" class="headerlink" title="1.背景简介"></a>1.背景简介</h2><p>我们公司开发了一款室内机平板APP应用，要求平板能去控制智能门锁、等其他智能设备，智能门锁不是我们公司开发的，与我们公司属于合作关系。</p>
<h2 id="2-分析及实现思路"><a href="#2-分析及实现思路" class="headerlink" title="2.分析及实现思路"></a>2.分析及实现思路</h2><ol>
<li>智能门锁的控制是通过使用 <strong>433射频</strong>（不了解的请百度）来进行通讯的；</li>
<li>平板是没法与智能门锁直接进行通讯，但是厂家提供了一个433通讯模块（支持串口）；</li>
<li>而平板（支持OTG）是支持USB转串口模块的，所以整个流程是可以走通的，如下图</li>
</ol>
<p><img src="https://img-blog.csdn.net/20180401005034848?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbnBlbmdmZWk1MjE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<h2 id="3-主要代码实现"><a href="#3-主要代码实现" class="headerlink" title="3.主要代码实现"></a>3.主要代码实现</h2><h3 id="3-1初始化USB转串口模块"><a href="#3-1初始化USB转串口模块" class="headerlink" title="3.1初始化USB转串口模块"></a>3.1初始化USB转串口模块</h3><p>由于我们选用的是CH340模块，我们先导入ch340的 <strong>jar</strong> 包，然后在代码中检查手机/平板是否支持USB HOST模式，如果支持我们就初始化通讯时的相关参数：波特率、数据位、停止位等，具体的参数看你们之间通讯的协议。初始化完成之后，我们就可以打开USB进行通讯了，同时初始化完成之后我们需要开启一个读取数据的线程，这样，一旦收到数据或者相应的响应包（一般也叫ACK）我们就可以进行相应的处理了。</p>
<p>下面贴上初始化、及开启读取数据线程的代码实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">     * initialize ch340 parameters.</span><br><span class="line">     *</span><br><span class="line">     * @param context Application context.</span><br><span class="line">     */</span><br><span class="line">    public static void initCH340(Context context) &#123;</span><br><span class="line">        if (context == null) return;</span><br><span class="line">        Context appContext = context.getApplicationContext();</span><br><span class="line">        mUsbManager = (UsbManager) appContext.getSystemService(Context.USB_SERVICE);</span><br><span class="line">        if (mUsbManager != null) &#123;</span><br><span class="line">            HashMap&lt;String, UsbDevice&gt; deviceHashMap = mUsbManager.getDeviceList();</span><br><span class="line">            for (UsbDevice device : deviceHashMap.values()) &#123;</span><br><span class="line">                if (device.getProductId() == 29987 &amp;&amp; device.getVendorId() == 6790) &#123;</span><br><span class="line">                    mUsbDevice = device;</span><br><span class="line">                    if (mUsbManager.hasPermission(device)) &#123;</span><br><span class="line">                        loadDriver(appContext, mUsbManager);</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        if (listener != null) &#123;</span><br><span class="line">                            listener.result(false);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * load ch340 driver.</span><br><span class="line">     *</span><br><span class="line">     * @param appContext</span><br><span class="line">     * @param usbManager</span><br><span class="line">     */</span><br><span class="line">    public static void loadDriver(Context appContext, UsbManager usbManager) &#123;</span><br><span class="line">        driver = new CH34xUARTDriver(usbManager, appContext, ACTION_USB_PERMISSION);</span><br><span class="line">        // 判断系统是否支持USB HOST</span><br><span class="line">        if (!driver.UsbFeatureSupported()) &#123;</span><br><span class="line">            InLog.e(TAG, &quot;Your mobile phone does not support USB HOST, please change other phones to try again!&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            openCH340();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * config and open ch340.</span><br><span class="line">     */</span><br><span class="line">    private static void openCH340() &#123;</span><br><span class="line">        int ret_val = driver.ResumeUsbList();</span><br><span class="line">        InLog.d(TAG, ret_val + &quot;&quot;);</span><br><span class="line">        // ResumeUsbList方法用于枚举CH34X设备以及打开相关设备</span><br><span class="line">        if (ret_val == -1) &#123;</span><br><span class="line">            InLog.d(TAG, ret_val + &quot;Failed to open device!&quot;);</span><br><span class="line">            driver.CloseDevice();</span><br><span class="line">        &#125; else if (ret_val == 0) &#123;</span><br><span class="line">            if (!driver.UartInit()) &#123;  //对串口设备进行初始化操作</span><br><span class="line">                InLog.d(TAG, ret_val + &quot;Failed device initialization!&quot;);</span><br><span class="line">                InLog.d(TAG, ret_val + &quot;Failed to open device!&quot;);</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            InLog.d(TAG, ret_val + &quot;Open device successfully!&quot;);</span><br><span class="line">            if (!isOpenDeviceCH340) &#123;</span><br><span class="line">                isOpenDeviceCH340 = true;</span><br><span class="line">                configParameters();//配置ch340的参数、需要先配置参数</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            InLog.d(TAG, &quot;The phone couldn&apos;t find the device！&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * config ch340 parameters.</span><br><span class="line">     * 配置串口波特率，函数说明可参照编程手册</span><br><span class="line">     */</span><br><span class="line">    private static void configParameters() &#123;</span><br><span class="line">        if (driver.SetConfig(baudRate, dataBit, stopBit, parity, flowControl)) &#123;</span><br><span class="line">            InLog.d(TAG, &quot;Successful serial port Settings！&quot;);</span><br><span class="line">            if (readDataRunnable == null) &#123;</span><br><span class="line">                readDataRunnable = new ReadDataRunnable();</span><br><span class="line">            &#125;</span><br><span class="line">            mThreadPool.execute(readDataRunnable);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            InLog.d(TAG, &quot;Serial port Settings failed！&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-2发送和接收数据"><a href="#3-2发送和接收数据" class="headerlink" title="3.2发送和接收数据"></a>3.2发送和接收数据</h3><p>发送和接收数据都是按16进制进行发送和处理的，所以我们写了一个工具类方便发送，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by xpf on 2018/2/6 :)</span><br><span class="line"> * Function:CH340数据处理工具类</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public class CH340Util &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * write data in ch340.</span><br><span class="line">     *</span><br><span class="line">     * @param byteArray 字节数组</span><br><span class="line">     * @return 返回写入的结果，-1表示写入失败！</span><br><span class="line">     */</span><br><span class="line">    public static int writeData(@NonNull byte[] byteArray) &#123;</span><br><span class="line">        // 将此处收到的数组转化为HexString</span><br><span class="line">        String hexString = bytesToHexString(byteArray, byteArray.length);</span><br><span class="line">        InLog.i(&quot;TAG&quot;, &quot;WriteHexString===&quot; + hexString);</span><br><span class="line">        return InitCH340.getDriver().WriteData(byteArray, byteArray.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * byte[]转换为hexString</span><br><span class="line">     *</span><br><span class="line">     * @param buffer 数据</span><br><span class="line">     * @param size   字符数</span><br><span class="line">     * @return 返回转换后的十六进制字符串</span><br><span class="line">     */</span><br><span class="line">    public static String bytesToHexString(byte[] buffer, final int size) &#123;</span><br><span class="line">        StringBuilder stringBuilder = new StringBuilder(&quot;&quot;);</span><br><span class="line">        if (buffer == null || size &lt;= 0) return null;</span><br><span class="line">        for (int i = 0; i &lt; size; i++) &#123;</span><br><span class="line">            String hex = Integer.toHexString(buffer[i] &amp; 0xff);</span><br><span class="line">            if (hex.length() &lt; 2) stringBuilder.append(0);</span><br><span class="line">            stringBuilder.append(hex);</span><br><span class="line">        &#125;</span><br><span class="line">        return stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后基本的发送和接收数据就写完了，发送数据时调用 <strong>writeData()</strong> 方法就可以了，接收数据也类似，具体的业务及通讯的协议、加密规则等都需要你和硬件提供方进行协商对接制定，由于涉及到公司机密，此处我就不进行说明了，只说一下最基本的发送和接收数据。</p>
<h2 id="4-插入模块实现自动打开APP"><a href="#4-插入模块实现自动打开APP" class="headerlink" title="4.插入模块实现自动打开APP"></a>4.插入模块实现自动打开APP</h2><p>Android中USB的插拔都会发送一个广播，我们只需要在AndroidMenifest.xml文件中接收这个广播就可以了，当我们入模块的时候就会启动我们的APP,第一次会弹出一个对话框询问我们是否打开xxx应用，我们点击确认即可，另外不是我们插入任何USB设备都打开我们的应用，所以我们需要过滤掉对我们没有用的设备，在res下建一个xml目录，新建usb_filter.xml文件，配置好我们这个USB设备模块的product-id和vendor-id，每个模块厂家这个值都是不一样的，有两种获取方式，一个是代码中枚举USB设备然后打印出来，另外一种方法是打开Logcat观察，然后插入USB设备，你会发现系统会打印出来这个USB设备等信息。</p>
<p>最后不要忘了添加权限：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;uses-feature</span><br><span class="line">       android:name=&quot;android.hardware.usb.host&quot;</span><br><span class="line">       android:required=&quot;true&quot; /&gt;</span><br><span class="line"></span><br><span class="line">   &lt;uses-permission android:name=&quot;android.hardware.usb.host&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p>此处由于篇幅原因就不具体展开讲解更多细节了，核心的代码和实现我都已经贴出来了，要想查看更具体的实现，请下载我的demo:</p>
<p><a href="https://github.com/xinpengfei520/USB-OTG-CH340-UART-interface" target="_blank" rel="noopener">https://github.com/xinpengfei520/USB-OTG-CH340-UART-interface</a></p>
<p>若在阅读过程中遇到什么问题，或有好提议，欢迎在公众号“CodingAndroid”中提出<br><img src="http://img.blog.csdn.net/20170911223615073" alt="这里写图片描述"></p>
<p>长按后点击扫一扫关注！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vance.xin/2017/09/24/Android截屏的几种实现/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="程序员飞飞">
      <meta itemprop="description" content="Android、Java Developer.">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员飞飞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/09/24/Android截屏的几种实现/" class="post-title-link" itemprop="url">Android 截屏的几种实现</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-24 23:47:57" itemprop="dateCreated datePublished" datetime="2017-09-24T23:47:57+08:00">2017-09-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-12-08 23:24:03" itemprop="dateModified" datetime="2018-12-08T23:24:03+08:00">2018-12-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          
            <span id="/2017/09/24/Android截屏的几种实现/" class="post-meta-item leancloud_visitors" data-flag-title="Android 截屏的几种实现" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2017/09/24/Android截屏的几种实现/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/09/24/Android截屏的几种实现/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>##方式一</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public static Bitmap capture(Activity activity) &#123;</span><br><span class="line">       activity.getWindow().getDecorView().setDrawingCacheEnabled(true);</span><br><span class="line">       Bitmap bmp = activity.getWindow().getDecorView().getDrawingCache();</span><br><span class="line">       return bmp;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>此种方式比较简单只需传入当前要截取屏幕的Activity对象即可，不需要添加任何权限，后续可将截图的bitmap保存到本地即可；</p>
<p>缺点：无法截取WebView页面，截屏后是白屏！</p>
<p>##方式二</p>
<p>使用adb Shell命令截屏</p>
<p>例如：</p>
<figure class="highlight plain"><figcaption><span>shell screencap -p</span><a href="/sdcard/sreenshot1.png```">link</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">命令格式：adb shell screencap -p + 文件路径 + 文件名</span><br><span class="line"></span><br><span class="line">##方式三</span><br><span class="line"></span><br><span class="line">从Android 5.0开始 Google开放了截屏的api</span><br><span class="line"></span><br><span class="line">截取方式如下：</span><br><span class="line"></span><br><span class="line">1.在Activity中开启截屏服务</span><br></pre></td></tr></table></figure>
<pre><code>if (Build.VERSION.SDK_INT &gt;= 21) {
        startActivityForResult(
                ((MediaProjectionManager) getSystemService(&quot;media_projection&quot;)).createScreenCaptureIntent(),1);
    } else {
        Log.e(&quot;TAG&quot;, &quot;版本过低,无法截屏&quot;);
    }
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2.重写**onActivityResult**方法</span><br></pre></td></tr></table></figure>
<pre><code>@Override
protected void onActivityResult(int requestCode, int resultCode, Intent data) {
    super.onActivityResult(requestCode, resultCode, data);
    switch (requestCode) {
        case REQUEST_MEDIA_PROJECTION: {
            if (resultCode == -1 &amp;&amp; data != null) {
                parseData(data);
            }
        }
    }
}

private void parseData(Intent data){
    MediaProjection mMediaProjection = (MediaProjectionManager).getSystemService(
            Context.MEDIA_PROJECTION_SERVICE).getMediaProjection(Activity.RESULT_OK,data);
        ImageReader mImageReader = ImageReader.newInstance(
                getScreenWidth(),
                getScreenHeight(),
                PixelFormat.RGBA_8888,1);

    VirtualDisplay mVirtualDisplay = mMediaProjection.createVirtualDisplay(&quot;screen-mirror&quot;,
            getScreenWidth(),
            getScreenHeight(),
            Resources.getSystem().getDisplayMetrics().densityDpi,
            DisplayManager.VIRTUAL_DISPLAY_FLAG_AUTO_MIRROR,
            mImageReader.getSurface(), null, null);

    Handler handler = new Handler();
    handler.postDelayed(new Runnable() {
       @Override
       public void run() {
           Image image = mImageReader.acquireLatestImage();
           // TODO 将image保存到本地即可
       }
    }, 300);

    mVirtualDisplay.release();
    mVirtualDisplay = null;
}
</code></pre><p><code>`</code></p>
<p>更多参考文章：</p>
<p><a href="http://www.jb51.net/article/119881.htm" target="_blank" rel="noopener">http://www.jb51.net/article/119881.htm</a></p>
<p><a href="https://www.2cto.com/kf/201602/488933.html" target="_blank" rel="noopener">https://www.2cto.com/kf/201602/488933.html</a></p>
<p><a href="http://blog.csdn.net/buptgshengod/article/details/39155979" target="_blank" rel="noopener">http://blog.csdn.net/buptgshengod/article/details/39155979</a></p>
<p>下面这个库封装了cmd截屏和5.0以上的截屏：</p>
<p><a href="https://github.com/Android-ScreenShot/AndroidScreenShotService" target="_blank" rel="noopener">https://github.com/Android-ScreenShot/AndroidScreenShotService</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vance.xin/2017/09/24/不可错过的几款GitHub开源项目/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="程序员飞飞">
      <meta itemprop="description" content="Android、Java Developer.">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员飞飞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/09/24/不可错过的几款GitHub开源项目/" class="post-title-link" itemprop="url">不可错过的几款GitHub开源项目</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-24 23:47:57" itemprop="dateCreated datePublished" datetime="2017-09-24T23:47:57+08:00">2017-09-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-12-08 22:38:09" itemprop="dateModified" datetime="2018-12-08T22:38:09+08:00">2018-12-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          
            <span id="/2017/09/24/不可错过的几款GitHub开源项目/" class="post-meta-item leancloud_visitors" data-flag-title="不可错过的几款GitHub开源项目" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2017/09/24/不可错过的几款GitHub开源项目/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/09/24/不可错过的几款GitHub开源项目/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>工作之余或者周末感觉无聊？不知道干什么？想继续提高技术，但是不知道做什么的同学，看过来，不妨利用闲暇时间来撸几个 GitHub 上还不错的开源项目，本文推荐的开源项目比较适合新手、及对MVP设计模式不太熟练的同学练习之用，下面逐一进行简单介绍。</p>
<h2 id="1-ZhiHuMVP"><a href="#1-ZhiHuMVP" class="headerlink" title="1.ZhiHuMVP"></a>1.ZhiHuMVP</h2><p>一款采用 MVP 模式的仿知乎客户端。</p>
<p>本项目包含以下知识点：</p>
<ul>
<li>MVP架构思想</li>
<li>Retrofit RESTful API 框架的配合</li>
<li>RxJava 响应式编程</li>
<li>Butter Knife：通过注解绑定 View</li>
<li>夜间模式切换</li>
</ul>
<p>效果图：</p>
<p><img src="https://img-blog.csdn.net/20180415212934402?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbnBlbmdmZWk1MjE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p><a href="https://github.com/fangx/ZhiHuMVP" target="_blank" rel="noopener">https://github.com/fangx/ZhiHuMVP</a></p>
<h2 id="2-ColorfulNews"><a href="#2-ColorfulNews" class="headerlink" title="2.ColorfulNews"></a>2.ColorfulNews</h2><p>一个 Material Design 风格的新闻阅读 App，采用 MVP 模式，基于 Dagger2+RxJava+Retrofit2进行开发。</p>
<p>主要用到的开源库：</p>
<ul>
<li>Dagger2</li>
<li>RxJava</li>
<li>Retrofit2</li>
<li>Butterknife</li>
<li>Greendao</li>
<li>PhotoView</li>
<li>Glide</li>
<li>Picasso</li>
<li>…</li>
</ul>
<p>效果图：</p>
<p><img src="https://img-blog.csdn.net/20180415213012428?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbnBlbmdmZWk1MjE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p><a href="https://github.com/kaku2015/ColorfulNews" target="_blank" rel="noopener">https://github.com/kaku2015/ColorfulNews</a></p>
<h2 id="3-boxing"><a href="#3-boxing" class="headerlink" title="3.boxing"></a>3.boxing</h2><p>Bilibili 开源的基于MVP模式的 Android 多媒体选择器。</p>
<p>特性：</p>
<ul>
<li>支持自定义UI</li>
<li>支持多/单图片选择和预览，单图裁剪功能</li>
<li>支持gif</li>
<li>支持视频选择功能</li>
<li>提供图片压缩</li>
<li>多图生成gif（checkout feature/gif-encode)</li>
</ul>
<p>效果图：</p>
<p><img src="https://img-blog.csdn.net/20180415213215868?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbnBlbmdmZWk1MjE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p><a href="https://github.com/Bilibili/boxing" target="_blank" rel="noopener">https://github.com/Bilibili/boxing</a></p>
<h2 id="4-MinimalistWeather"><a href="#4-MinimalistWeather" class="headerlink" title="4.MinimalistWeather"></a>4.MinimalistWeather</h2><p>MinimalistWeather 是 Android 平台上一款开源天气 App ，目前还在开发中。项目基于 MVP 架构，采用各主流开源库实现。开发此项目主要是为展示各种开源库的使用方式以及 Android 项目的设计方案，并作为团队项目开发规范的一部分。</p>
<p>采用的开源库包括：</p>
<ul>
<li>RxJava</li>
<li>Retrofit2</li>
<li>OKHttp3</li>
<li>ORMLite</li>
<li>Dagger2</li>
<li>ButterKnife</li>
<li>RetroLambda</li>
<li>Stetho</li>
</ul>
<p>本项目还展示了：</p>
<ul>
<li>MVP+RxJava在实际项目中的应用，MVP中RxJava生命周期的管理…；</li>
<li>上述罗列的各种开源框架的使用方法；</li>
<li>Java8 Lambda表达式和Stream API的用法；</li>
<li>怎样适配Material Design；</li>
<li>ToolBar、RecycleView、CardView、CoordinatorLayout等新控件的用法；</li>
<li>Gradle的基本配置（包括签名打包、项目依赖等等）；</li>
<li>如何更好的管理Gradle依赖库的版本；</li>
<li>代码混淆配置；</li>
<li>如何快速开发一款结构清晰、可扩展性强的Android Application。</li>
</ul>
<p><a href="https://github.com/BaronZ88/MinimalistWeather" target="_blank" rel="noopener">https://github.com/BaronZ88/MinimalistWeather</a></p>
<h2 id="5-TranslateApp"><a href="#5-TranslateApp" class="headerlink" title="5.TranslateApp"></a>5.TranslateApp</h2><p>一个实现 『划词翻译』 功能的 Android 应用 ，可能是目前 Android 市场上翻译效率最高的一款应用。</p>
<p>技术点:</p>
<ul>
<li>全程使用 Dagger2 对项目进行类依赖管理</li>
<li>项目使用标准的 MVP 架构，关于 MVP 的一篇博客</li>
<li>实现对粘贴板的监听以及访问</li>
<li>无需权限显示悬浮窗（6.0悬浮窗权限适配）</li>
<li>使用 RxJava 探索函数式编程</li>
<li>使用 Retrofit2 进行网络请求</li>
<li>开机自启动</li>
<li>Android 6.0 自定义文本操作栏</li>
</ul>
<p>效果图：</p>
<p><img src="https://img-blog.csdn.net/20180415213307416?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbnBlbmdmZWk1MjE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p><a href="https://github.com/maoruibin/TranslateApp" target="_blank" rel="noopener">https://github.com/maoruibin/TranslateApp</a></p>
<h2 id="6-Ghost"><a href="#6-Ghost" class="headerlink" title="6.Ghost"></a>6.Ghost</h2><p>微影，一款纯粹的在线视频App，基于Material Design + MVP + Dagger2 + RxJava + Retrofit + Realm + Glide。</p>
<p>技术点：</p>
<ul>
<li>使用RxJava配合Retrofit2做网络请求</li>
<li>使用RxUtil对线程操作和网络请求结果处理做了封装</li>
<li>使用RxPresenter对订阅的生命周期做管理</li>
<li>使用AndroidEventBus来方便组件间的通信</li>
<li>使用Material Design控件和动画</li>
<li>使用MVP架构整个项目，对应于model、ui、presenter三个包</li>
<li>使用Realm做阅读记录和收藏记录的增、删、查、改</li>
<li>使用Glide做图片的处理和加载</li>
<li>使用RecyclerView实现下拉刷新、上拉加载、侧滑删除、长按拖曳</li>
<li>支持主题设置</li>
<li>包含搜索、收藏、历史等功能</li>
</ul>
<p>效果图：</p>
<p><img src="https://img-blog.csdn.net/20180415213325438?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbnBlbmdmZWk1MjE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p><a href="https://github.com/GeekGhost/Ghost" target="_blank" rel="noopener">https://github.com/GeekGhost/Ghost</a></p>
<h2 id="7-GeekNews"><a href="#7-GeekNews" class="headerlink" title="7.GeekNews"></a>7.GeekNews</h2><p>极客日报，一款纯粹的阅读App，基于Material Design + MVP + RxJava2 + Retrofit + Dagger2 + Realm + Glide。</p>
<p>技术点：</p>
<ul>
<li>使用RxJava配合Retrofit2做网络请求</li>
<li>使用RxUtil对线程操作和网络请求结果处理做了封装</li>
<li>使用RxPresenter对订阅的生命周期做管理</li>
<li>使用RxBus来方便组件间的通信</li>
<li>使用RxJava其他操作符来做延时、轮询、转化、筛选等操作</li>
<li>使用okhttp3对网络返回内容做缓存，还有日志、超时重连、头部消息的配置</li>
<li>使用Material Design控件和动画</li>
<li>使用MVP架构整个项目，对应于model、ui、presenter三个包</li>
<li>使用Dagger2将M层注入P层，将P层注入V层，无需new，直接调用对象</li>
<li>使用Realm做阅读记录和收藏记录的增、删、查、改</li>
<li>使用Glide做图片的处理和加载</li>
<li>使用Fragmentation简化Fragment的操作和懒加载</li>
<li>使用RecyclerView实现下拉刷新、上拉加载、侧滑删除、长按拖曳</li>
<li>使用x5WebView做阅览页，比原生WebView体验更佳</li>
<li>使用SVG及其动画实现progressbar的效果</li>
<li>使用RxPermissions做6.0+动态权限适配</li>
<li>使用Jsoup解析V2EX站点DOM</li>
<li>使用原生的夜间模式、分享、反馈</li>
<li>包含搜索、收藏、检测更新等功能</li>
<li>所有踩到的坑都在项目里做了注释</li>
</ul>
<p>效果图：</p>
<p><img src="https://img-blog.csdn.net/20180415213349333?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbnBlbmdmZWk1MjE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p><a href="https://github.com/codeestX/GeekNews" target="_blank" rel="noopener">https://github.com/codeestX/GeekNews</a></p>
<h2 id="8-MovieGuide"><a href="#8-MovieGuide" class="headerlink" title="8.MovieGuide"></a>8.MovieGuide</h2><p>MovieGuide是一款受欢迎、高级别的电影Android应用，展示了预告片和评论等功能。采用了MVP模式、RxJava、Dagger 2 和 Bob Martin 的 Clean 架构方法，并针对平板电脑进行了优化。</p>
<p>效果图：</p>
<p><img src="https://img-blog.csdn.net/20180415213413595?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbnBlbmdmZWk1MjE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p><a href="https://github.com/esoxjem/MovieGuide" target="_blank" rel="noopener">https://github.com/esoxjem/MovieGuide</a></p>
<h2 id="9-SimpleNews"><a href="#9-SimpleNews" class="headerlink" title="9.SimpleNews"></a>9.SimpleNews</h2><p>基于Material Design和MVP的新闻客户端。</p>
<p>效果图：</p>
<p><img src="https://img-blog.csdn.net/20180415213429841?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbnBlbmdmZWk1MjE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p><a href="https://github.com/liuling07/SimpleNews" target="_blank" rel="noopener">https://github.com/liuling07/SimpleNews</a></p>
<h2 id="10-Toutiao"><a href="#10-Toutiao" class="headerlink" title="10.Toutiao"></a>10.Toutiao</h2><p>一款第三方今日头条客户端，遵循材料设计(Material Design), 聚合了新闻/段子/图片/视频/头条号内容, 没有广告, 仅仅只有存粹的阅读, 不断完善中, 采用 MVP + RxJava + Retrofit 架构的项目。</p>
<p>主要功能特性：</p>
<ul>
<li>首页五大模块: 新闻 / 图片 / 视频 / 头条号 / 问答</li>
<li>实现首页的布局和数据的显示</li>
<li>实现自定义新闻栏目顺序</li>
<li>新闻详情页面支持日夜两种主题</li>
<li>显示新闻评论</li>
<li>头条号订阅 查看头条号历史文章 / 视频</li>
<li>搜索功能 热门搜索推荐 搜索历史记录</li>
<li>自定义主题颜色 无缝切换日夜皮肤</li>
<li>视频播放</li>
<li>内置3款 logo 随意互换</li>
<li>动态切换字体大小</li>
</ul>
<p>主要技术点：</p>
<ul>
<li>基本遵循 Material Design 设计风格</li>
<li>抓包获取今日头条API</li>
<li>使用 Google 官方 MVP 架构</li>
<li>DrawerLayout + NavigationView + BottomNavigationView 搭配使用</li>
<li>RxBus 代替 EventBus 进行组件之间通讯</li>
<li>ViewPager 搭配 Fragment 懒加载</li>
<li>SwipeRefreshLayout 搭配 RecyclerView 下拉刷新上拉加载</li>
<li>自定义 BottomNavigationBehavior 实现上滑隐藏下滑显示</li>
<li>RxJava + Retrofit2 + OkHttp3 做网络请求</li>
<li>OkHttp3 对网络返回内容做缓存, 还有日志、超时重连、头部消息的配置</li>
<li>V层基类的构建, 包括 BaseActivity 和 BaseFragment , 对外提供了相同的接口</li>
<li>使用原生的夜间模式</li>
<li>解决侧滑返回与 View 冲突问题</li>
<li>内置 3 款 Logo, 随意切换</li>
<li>使用 CoordinatorLayout 、 AppBarLayout 、 CollapsingToolbarLayout 、    BottomSheetDialog 等新控件</li>
<li>使用 7.0 新工具 DiffUtil , 不再无脑 notifyDataSetChanged</li>
<li>使用 ItemTouchHelper 实现今日头条的频道排序、频道移动, 参考 ItemTouchHelperDemo</li>
<li>使用 RxBinding 优雅实现搜索请求</li>
<li>使用 AutoDispose 绑定 RxJava 生命周期</li>
<li>使用 Travis Cl 持续集成</li>
</ul>
<p>效果图：</p>
<p><img src="https://img-blog.csdn.net/20180415213453688?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbnBlbmdmZWk1MjE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p><a href="https://github.com/iMeiji/Toutiao" target="_blank" rel="noopener">https://github.com/iMeiji/Toutiao</a></p>
<h2 id="11-PhotoNoter"><a href="#11-PhotoNoter" class="headerlink" title="11.PhotoNoter"></a>11.PhotoNoter</h2><p>Material Design风格的开源照片笔记。</p>
<p>主要技术点：</p>
<ul>
<li>整体项目MVP结构</li>
<li>Dagger2</li>
<li>相机部分，API &gt;= 21使用 Camera2 ，API &lt; 21使用 Camera</li>
<li>相机的状态机，聚焦状态机</li>
<li>照片缓存分为两种，一个是大图，一个是小图，小图是相册界面缩略图的时候加载的，大图是查看图片的时候加载的</li>
<li>图片处理</li>
<li>沙盒</li>
<li>Activity 退出和进入的动画</li>
<li>一些 UI 的动画，比如 “ 意见反馈”、 “ 语音输入” 这里面的动画</li>
<li>主题设置，沉浸式状态栏（Android 5.0）</li>
<li>切换主题</li>
<li>可以滑动 item 和可以拖放 item 的 ListView（SlideAndDragListView）</li>
<li>Android 原生平台的 Markdown，支持 EditText 编辑实时预览 （RxMarkdown）</li>
<li>RxJava + RxAndroid（RxCategory/ RxPhotoNote/ RxSandBox/ RxFeedBack/ RxUser）</li>
<li>dex分包处理</li>
<li>Dex自动分包脚本</li>
<li>使用 AOP 进行 Android 6.0 权限适配</li>
<li>NDK &amp;&amp; AIDL</li>
</ul>
<p>效果图：</p>
<p><img src="https://img-blog.csdn.net/20180415213523640?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3hpbnBlbmdmZWk1MjE=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述"></p>
<p><a href="https://github.com/yydcdut/PhotoNoter" target="_blank" rel="noopener">https://github.com/yydcdut/PhotoNoter</a></p>
<p>好了，终于介绍完了，由于本文篇幅比较长，建议 「收藏」，欢迎大家评论点赞或者转发，如有更多想法欢迎在下方留言。</p>
<p>重要声明：本文中介绍的所有开源项目所有权仍归原开源作者所有，本文仅对原作者的开源项目进行介绍、整理说明，供参考、学习交流之用。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vance.xin/2017/09/24/51单片机矩阵键盘C程序/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="程序员飞飞">
      <meta itemprop="description" content="Android、Java Developer.">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员飞飞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/09/24/51单片机矩阵键盘C程序/" class="post-title-link" itemprop="url">51单片机矩阵键盘C程序</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-24 23:47:57" itemprop="dateCreated datePublished" datetime="2017-09-24T23:47:57+08:00">2017-09-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-12-08 22:25:20" itemprop="dateModified" datetime="2018-12-08T22:25:20+08:00">2018-12-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/嵌入式/" itemprop="url" rel="index"><span itemprop="name">嵌入式</span></a>
                </span>
            </span>

          
            <span id="/2017/09/24/51单片机矩阵键盘C程序/" class="post-meta-item leancloud_visitors" data-flag-title="51单片机矩阵键盘C程序" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2017/09/24/51单片机矩阵键盘C程序/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/09/24/51单片机矩阵键盘C程序/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="主程序1："><a href="#主程序1：" class="headerlink" title="主程序1："></a>主程序1：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">   uchar i,j,k</span><br><span class="line">   i=0;</span><br><span class="line">   j=0;</span><br><span class="line">   while(1)</span><br><span class="line">   &#123;</span><br><span class="line">      i=key();//键盘循环扫描，其值赋给变量数组table</span><br><span class="line">      if(i!=0)//键盘子程序返回值非0，即有按键按下</span><br><span class="line">      &#123;</span><br><span class="line">          table[j]=i;//将值存在变量数组中</span><br><span class="line"></span><br><span class="line">j++;                                                          </span><br><span class="line">      &#125;</span><br><span class="line">      if(j==6)</span><br><span class="line">      &#123;</span><br><span class="line">         j=0;</span><br><span class="line">         for(k=0;k&lt;6;k++)//当数组存满6位时核对</span><br><span class="line">         &#123;</span><br><span class="line">             P3=table[k];//P3接有一排指示灯</span><br><span class="line">             delay (1000);//延时1S    </span><br><span class="line">         &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="主程序2："><a href="#主程序2：" class="headerlink" title="主程序2："></a>主程序2：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">main()&#123;</span><br><span class="line">int i,j,a[2][5]=&#123;10,15,25,15,75,15,45,65,85,95&#125;;</span><br><span class="line">for(i=0;i&lt;2;i++)</span><br><span class="line">for(j=0;j&lt;5;j++)&#123;</span><br><span class="line">printf(&quot;%d &quot;,a[i][j]);</span><br><span class="line">&#125;</span><br><span class="line">printf(&quot;\n&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="主程序3："><a href="#主程序3：" class="headerlink" title="主程序3："></a>主程序3：</h2><p>由键盘输入一个3×4矩阵a，选出各列最小的元素组成一个一维数组b并输出<br>由键盘输入一个3×4矩阵a，选出各列最小的元素组成一个一维数组b并输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">	#include &quot;stdio.h&quot;</span><br><span class="line">	#include &quot;conio.h&quot;</span><br><span class="line">void main()</span><br><span class="line">&#123;</span><br><span class="line">int i,j,a[3][4],b[4],min;</span><br><span class="line">for(i=0;i&lt;3;i++)</span><br><span class="line">for(j=0;j&lt;4;j++)</span><br><span class="line">scanf(&quot;%d&quot;,&amp;a[i][j]);</span><br><span class="line">for(i=0;i&lt;4;i++)</span><br><span class="line">b[i]=a[0][i];</span><br><span class="line">for (i=0;i&lt;4;i++)</span><br><span class="line">for(j=1;j&lt;2;j++)</span><br><span class="line">if(a[i][j]&lt;b[i]) b[i]=a[i][j];</span><br><span class="line">for(i=0;i&lt;4;i++)</span><br><span class="line">printf(&quot;%d&quot;,b[i]);</span><br><span class="line">    getch();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>梦里求她千百度，蓦然回首，那人却在灯火阑珊处。。。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vance.xin/2017/09/24/常用Git命令手册/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="程序员飞飞">
      <meta itemprop="description" content="Android、Java Developer.">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员飞飞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/09/24/常用Git命令手册/" class="post-title-link" itemprop="url">常用 Git 命令手册</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-24 23:47:57" itemprop="dateCreated datePublished" datetime="2017-09-24T23:47:57+08:00">2017-09-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-12-08 23:03:29" itemprop="dateModified" datetime="2018-12-08T23:03:29+08:00">2018-12-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/工具/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
                </span>
            </span>

          
            <span id="/2017/09/24/常用Git命令手册/" class="post-meta-item leancloud_visitors" data-flag-title="常用 Git 命令手册" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2017/09/24/常用Git命令手册/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/09/24/常用Git命令手册/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>此文只是对Git有一定基础的人当记忆使用，比较简略，初级学员强烈推荐廖雪峰老师的Git系列教程，通俗易懂，<a href="https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000" target="_blank" rel="noopener">戳此处即可开始学习</a></p>
<h3 id="1-安装Git"><a href="#1-安装Git" class="headerlink" title="1.安装Git"></a>1.安装Git</h3><ul>
<li><p>Linux</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure>
</li>
<li><p>Window:到Git官网下载安装：<a href="https://git-scm.com/downloads" target="_blank" rel="noopener">https://git-scm.com/downloads</a></p>
</li>
</ul>
<h3 id="2-配置全局用户Name和E-mail"><a href="#2-配置全局用户Name和E-mail" class="headerlink" title="2.配置全局用户Name和E-mail"></a>2.配置全局用户Name和E-mail</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.name &quot;Your Name&quot;</span><br><span class="line">$ git config --global user.email &quot;email@example.com&quot;</span><br></pre></td></tr></table></figure>
<h3 id="3-初始化仓库"><a href="#3-初始化仓库" class="headerlink" title="3.初始化仓库"></a>3.初始化仓库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></figure>
<h3 id="4-添加文件到Git仓库"><a href="#4-添加文件到Git仓库" class="headerlink" title="4.添加文件到Git仓库"></a>4.添加文件到Git仓库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add &lt;file&gt;</span><br></pre></td></tr></table></figure>
<p>提示：可反复多次使用，添加多个文件；</p>
<h3 id="5-提交添加的文件到Git仓库"><a href="#5-提交添加的文件到Git仓库" class="headerlink" title="5.提交添加的文件到Git仓库"></a>5.提交添加的文件到Git仓库</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit</span><br></pre></td></tr></table></figure>
<p>然后会弹出一个Vim编辑器输入本次提交的内容；</p>
<p>或者</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m &quot;提交说明&quot;</span><br></pre></td></tr></table></figure>
<h3 id="6-查看仓库当前的状态"><a href="#6-查看仓库当前的状态" class="headerlink" title="6.查看仓库当前的状态"></a>6.查看仓库当前的状态</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git status</span><br></pre></td></tr></table></figure>
<h3 id="7-比较当前文件的修改"><a href="#7-比较当前文件的修改" class="headerlink" title="7.比较当前文件的修改"></a>7.比较当前文件的修改</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git diff &lt;file&gt;</span><br></pre></td></tr></table></figure>
<h3 id="8-查看历史提交记录"><a href="#8-查看历史提交记录" class="headerlink" title="8.查看历史提交记录"></a>8.查看历史提交记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git log</span><br></pre></td></tr></table></figure>
<p>或者加上参数查看就比较清晰了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git log --pretty=oneline</span><br></pre></td></tr></table></figure>
<h3 id="9-回退版本"><a href="#9-回退版本" class="headerlink" title="9.回退版本"></a>9.回退版本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git reset --hard HEAD^</span><br></pre></td></tr></table></figure>
<p>说明：在Git中，用HEAD表示当前版本，上一个版本就是HEAD^，上上一个版本就是HEAD^^，以此类推，如果需要回退几十个版本，写几十个^容易数不过来，所以可以写，例如回退30个版本为：HEAD~30。</p>
<p>如果你回退完版本又后悔了，想回来，一般情况下是回不来的，但是如果你可以找到你之前的commit id的话，也是可以的，使用如下即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git reset --hard + commit id</span><br></pre></td></tr></table></figure>
<p>提示：commit id不需要写全，Git会自动查找；</p>
<p>补充说明：Git中，commit id是一个使用SHA1计算出来的一个非常大的数字，用十六进制表示，你提交时看到的一大串类似3628164…882e1e0的就是commit id（版本号）；</p>
<p>在Git中，版本回退速度非常快，因为Git在内部有个指向当前版本的HEAD指针，当你回退版本的时候，Git仅仅是把HEAD从指向回退的版本，然后顺便刷新工作区文件；</p>
<h3 id="10-查看操作的历史命令记录"><a href="#10-查看操作的历史命令记录" class="headerlink" title="10.查看操作的历史命令记录"></a>10.查看操作的历史命令记录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git reflog</span><br></pre></td></tr></table></figure>
<p>结果会将你之前的操作的commit id和具体的操作类型及相关的信息打印出来，这个命令还有一个作用就是，当你过了几天，你想回退之前的某次提交，但是你不知道commit id了，通过这个你可查找出commit id,就可以轻松回退了，用一句话总结：穿越未来，回到过去，so easy！</p>
<h3 id="11-diff文件"><a href="#11-diff文件" class="headerlink" title="11.diff文件"></a>11.diff文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git diff HEAD -- &lt;file&gt;</span><br></pre></td></tr></table></figure>
<p>说明：查看工作区和版本库里面最新版本文件的区别，也可以不加HEAD参数；</p>
<p>###12.丢弃工作区的修改</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -- &lt;file&gt;</span><br></pre></td></tr></table></figure>
<p>说明：适用于工作区修改没有add的文件</p>
<h3 id="13-丢弃暂存区的文件"><a href="#13-丢弃暂存区的文件" class="headerlink" title="13.丢弃暂存区的文件"></a>13.丢弃暂存区的文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git reset HEAD &lt;file&gt;</span><br></pre></td></tr></table></figure>
<p>说明：适用于暂存区已经add的文件，注意执行完此命令，他会将暂存区的修改放回到工作区中，如果要想工作区的修改也丢弃，就执行第12条命令即可；</p>
<h3 id="14-删除文件"><a href="#14-删除文件" class="headerlink" title="14.删除文件"></a>14.删除文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ rm &lt;file&gt;</span><br></pre></td></tr></table></figure>
<p>然后提交即可；</p>
<p>如果不小心删错了，如果还没有提交的话使用下面命令即可恢复删除，注意的是它只能恢复最近版本提交的修改，你工作区的修改是不能被恢复的！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -- &lt;file&gt;</span><br></pre></td></tr></table></figure>
<h3 id="15-创建SSH-key"><a href="#15-创建SSH-key" class="headerlink" title="15.创建SSH key"></a>15.创建SSH key</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -C &quot;youremail@example.com&quot;</span><br></pre></td></tr></table></figure>
<p>一般本地Git仓库和远程Git仓库之间的传输是通过SSH加密的，所以我们可以将其生成的公钥添加到Git服务端的设置中即可，这样Git就可以知道是你提交的了；</p>
<h3 id="16-与远程仓库协作"><a href="#16-与远程仓库协作" class="headerlink" title="16.与远程仓库协作"></a>16.与远程仓库协作</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add origin git@github.com:xinpengfei520/IM.git</span><br></pre></td></tr></table></figure>
<p>删除本地库与远程库的关联：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote rm origin</span><br></pre></td></tr></table></figure>
<p>作用：有时候我们需要关联其他远程库，需要先删除旧的关联，再添加新的关联，因为如果你已经关联过了就不能在关联了，不过想关联多个远程库也是可以的，前提是你的本地库没有关联任何远程库，操作如下：</p>
<p>先关联Github远程库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add github git@github.com:xinpengfei520/IM.git</span><br></pre></td></tr></table></figure>
<p>接着关联码云远程库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote add gitee git@gitee.com:xinpengfei521/IM.git</span><br></pre></td></tr></table></figure>
<p>现在，我们用<figure class="highlight plain"><figcaption><span>remote -v```查看远程库的关联信息，如果看到两组关联信息就说明关联成功了；</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ok,现在我们的本地库可以和多个远程库协作了</span><br><span class="line"></span><br><span class="line">如果要推送到GitHub，使用命令：</span><br></pre></td></tr></table></figure></p>
<p>$ git push github master<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">如果要推送到码云，使用命令：</span><br></pre></td></tr></table></figure></p>
<p>$ git push gitee master<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 17.推送到远程仓库</span><br></pre></td></tr></table></figure></p>
<p>$ git push -u origin master<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">注意：第一次提交需要加一个参数-u,以后不需要</span><br><span class="line"></span><br><span class="line">推送master到远程库</span><br></pre></td></tr></table></figure></p>
<p>$ git push origin master<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">推送branch1到远程库</span><br></pre></td></tr></table></figure></p>
<p>$ git push origin branch1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">推送分支时需要注意，你在那个分支时就推那个分支！例如，不可以在master分支推到其他分支上去！！！</span><br><span class="line"></span><br><span class="line">### 18.克隆一个远程库</span><br></pre></td></tr></table></figure></p>
<p>$ git clone <a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a>:xinpengfei520/IM.git<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 19.Git分支管理</span><br><span class="line"></span><br><span class="line">创建一个分支branch1</span><br></pre></td></tr></table></figure></p>
<p>$ git branch branch1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">切换到branch1分支：</span><br></pre></td></tr></table></figure></p>
<p>$ git checkout branch1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">创建并切换到branch1分支：</span><br></pre></td></tr></table></figure></p>
<p>$ git checkout -b branch1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">查看分支：</span><br></pre></td></tr></table></figure></p>
<p>$ git branch<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">提示：显示的结果中，其中有一个分支前有个*号，表示的是当前所在的分支；</span><br><span class="line"></span><br><span class="line">合并branch1分支到master：</span><br></pre></td></tr></table></figure></p>
<p>$ git merge branch1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">删除分支：</span><br></pre></td></tr></table></figure></p>
<p>$ git branch -d branch1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">拉取一个远程的分支的同时并创建一个本地分支：</span><br></pre></td></tr></table></figure></p>
<p>$ git fetch origin branch:branch<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 20.查看提交的历史记录</span><br></pre></td></tr></table></figure></p>
<p>$ git log<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">命令可以看到分支合并图</span><br></pre></td></tr></table></figure></p>
<p>git log –graph<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 21.合并分支</span><br><span class="line"></span><br><span class="line">禁用Fast forward模式合并分支</span><br></pre></td></tr></table></figure></p>
<p>$ git merge –no-ff -m “merge” branch1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">说明：默认Git合并分支时使用的是Fast forward模式，这种模式合并，删除分支后，会丢掉分支信息，所以我们需要强制禁用此模式来合并；</span><br><span class="line"></span><br><span class="line">补充内容：实际开发中分支管理的策略</span><br><span class="line"></span><br><span class="line"> - master分支应该是非常稳定的，也就是仅用来发布新版本，平时不能在上面提交；</span><br><span class="line"> - 我们可以新开一个dev分支，也就是说dev分支是不稳定的，到版本发布时，再把dev分支合并到master上，在master分支发布新版本；</span><br><span class="line"> - 你和你的协作者平时都在dev分支上提交，每个人都有自己的分支，时不时地往dev分支上合并就可以了；</span><br><span class="line"></span><br><span class="line">### 22.保存工作现场</span><br></pre></td></tr></table></figure></p>
<p>$ git stash<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">作用：当你需要去修改其他内容时，这时候你的工作还没有做完，先临时保存起来，等干完其他事之后，再回来回复现场，再继续干活；为什么？因为暂存区是公用的，如果不通过stash命令隐藏，会带到其它分支去；</span><br><span class="line"></span><br><span class="line">查看已经保存的工作现场列表：</span><br></pre></td></tr></table></figure></p>
<p>$ git stash list<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">恢复工作现场(恢复并从stash list删除)：</span><br></pre></td></tr></table></figure></p>
<p>$ git stash pop<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">或者：</span><br></pre></td></tr></table></figure></p>
<p>git stash apply<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">恢复工作现场，但stash内容并不删除，如果你需要删除执行如下命令：</span><br></pre></td></tr></table></figure></p>
<p>$ git stash drop<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">恢复指定的stash:</span><br></pre></td></tr></table></figure></p>
<p>$ git stash apply stash@{0}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">说明：其中stash@&#123;0&#125;为```git stash list```中的一种编号</span><br><span class="line"></span><br><span class="line">### 23.丢弃一个没有被合并过的分支</span><br><span class="line"></span><br><span class="line">强行删除即可：</span><br></pre></td></tr></table></figure></p>
<p>$ git branch -D <name><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">作用：实际开发中，添加一个新feature，最好新建一个分支，如果要丢弃这个没有被合并过的分支，可以通过上面的命令强行删除；</span><br><span class="line"></span><br><span class="line">### 24.查看远程库的信息</span><br></pre></td></tr></table></figure></name></p>
<p>$ git remote<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">显示更详细的信息：</span><br></pre></td></tr></table></figure></p>
<p>$ git remote -v<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 25.拉取分支</span><br><span class="line"></span><br><span class="line">拉取master到本地</span><br></pre></td></tr></table></figure></p>
<p>$ git pull origin master<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">拉取 branch1 分支的内容到本地</span><br></pre></td></tr></table></figure></p>
<p>$ git pull origin branch1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">拉取时要注意本地已经有和远程分支对应了，如果没有的话，参考 19 中，拉取并创建本地分支，拉取时需要注意，你在那个分支时就拉取个分支！不可以在 master 分支拉取其他分支下来，这样会把远程的其他分支拉取下来和本地master分支合并！！！引起不必要的麻烦！</span><br><span class="line"></span><br><span class="line">如果不小心拉取下来了，就可以使用下面的命令，恢复到上一次提交：</span><br></pre></td></tr></table></figure></p>
<p>$ git reset HEAD^<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 26.创建本地分支</span><br></pre></td></tr></table></figure></p>
<p>$ git checkout -b branch1 origin/branch1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">说明：如果远程库中有分支，clone之后默认只有master分支的，所以需要执行如上命令来创建本地分支才能与远程的分支关联起来；</span><br><span class="line"></span><br><span class="line">### 27.指定本地branch1分支与远程origin/branch1分支的链接</span><br></pre></td></tr></table></figure></p>
<p>$ git branch –set-upstream branch1 origin/branch1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">作用：如果你本地新建的branch1分支，远程库中也有一个branch1分支(别人创建的)，而刚好你也没有提交过到这个分支，即没有关联过，会报一个```no tracking information```信息，通过上面命令关联即可；</span><br><span class="line"></span><br><span class="line">### 28.创建标签</span><br></pre></td></tr></table></figure></p>
<p>$ git tag <name><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">例如：```git tag v1.0</span><br></pre></td></tr></table></figure></name></p>
<p>查看所有标签：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag</span><br></pre></td></tr></table></figure>
<p>对历史提交打tag</p>
<p>先使用<figure class="highlight plain"><figcaption><span>git log --pretty</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">例如对commit id 为123456的提交打一个tag:</span><br></pre></td></tr></table></figure></p>
<p>$ git tag v0.9 123456<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">查看标签信息：</span><br></pre></td></tr></table></figure></p>
<p>$ git show <tagname><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">eg:```git show v1.0</span><br></pre></td></tr></table></figure></tagname></p>
<p>创建带有说明的标签，用-a指定标签名，-m指定说明文字，123456为commit id：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -a v1.0 -m &quot;V1.0 released&quot; 123456</span><br></pre></td></tr></table></figure>
<p>用私钥签名一个标签：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -s v2.0 -m &quot;signed V2.0 released&quot; 345678</span><br></pre></td></tr></table></figure>
<p>说明：签名采用PGP签名，因此，必须先要安装gpg（GnuPG），如果没有找到gpg，或者没有gpg密钥对，就会报错，具体请参考GnuPG帮助文档配置Key；</p>
<p>作用：用PGP签名的标签是不可伪造的，因为可以验证PGP签名；</p>
<p>删除标签：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git tag -d &lt;tagname&gt;</span><br></pre></td></tr></table></figure>
<p>删除远程库中的标签：</p>
<p>比如要删除远程库中的 <strong>V1.0</strong> 标签，分两步：</p>
<p> [1] 先删除本地标签：<figure class="highlight plain"><figcaption><span>git tag -d V1.0```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[2] 再推送删除即可：```$ git push origin :refs/tags/V1.0</span><br></pre></td></tr></table></figure></p>
<p>推送标签到远程库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin &lt;tagname&gt;</span><br></pre></td></tr></table></figure>
<p>推送所有标签到远程库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin --tags</span><br></pre></td></tr></table></figure>
<h3 id="29-自定义Git设置"><a href="#29-自定义Git设置" class="headerlink" title="29.自定义Git设置"></a>29.自定义Git设置</h3><p>Git显示颜色，会让命令输出看起来更清晰、醒目：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global color.ui true</span><br></pre></td></tr></table></figure>
<p>设置命令别名：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global alias.st status</span><br></pre></td></tr></table></figure>
<p>说明：–global表示全局，即设置完之后全局生效，st表示别名，status表示原始名</p>
<p>好了，现在敲<figure class="highlight plain"><figcaption><span>st```就相当于是```git status```命令了，是不是方便？</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">当然还有其他命令可以简写，这里举几个：很多人都用co表示checkout，ci表示commit，br表示branch...</span><br><span class="line">根据自己的喜好可以设置即可，个人觉得不是很推荐使用别名的方式；</span><br><span class="line"></span><br><span class="line">推荐一个比较丧心病狂的别名设置：</span><br></pre></td></tr></table></figure></p>
<p>git config –global alias.lg “log –color –graph –pretty=format:’%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)&lt;%an&gt;%Creset’ –abbrev-commit”<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">效果自己去体会...</span><br><span class="line"></span><br><span class="line">其他说明：配置的时候加上--global是针对当前用户起作用的，如果不加只对当前的仓库起作用；每个仓库的Git配置文件都放在 **.git/config** 文件中，我们可以打开对其中的配置作修改，可以删除设置的别名；而当前用户的Git配置文件放在用户主目录下的一个隐藏文件.gitconfig中，我们也可以对其进行配置和修改。</span><br><span class="line"></span><br><span class="line">### 30.忽略文件规则</span><br><span class="line"></span><br><span class="line">原则：</span><br><span class="line"></span><br><span class="line"> - 忽略系统自动生成的文件等；</span><br><span class="line"> - 忽略编译生成的中间文件、可执行文件等，比如Java编译产生的.class文件，自动生成的文件就没必要提交；</span><br><span class="line"> - 忽略你自己的带有敏感信息的配置文件，个人相关配置文件；</span><br><span class="line"> - 忽略与自己相关开发环境相关的配置文件；</span><br><span class="line"> - ...</span><br><span class="line"></span><br><span class="line">使用：在Git工作区的根目录下创建一个特殊的 **.gitignore** 文件，然后把要忽略的文件名或者相关规则填进去，Git就会自动忽略这些文件，不知道怎么写的可参考：[https://github.com/github/gitignore](https://github.com/github/gitignore),这里提供了一些忽略的规则，可供参考；</span><br><span class="line"></span><br><span class="line">如果你想添加一个被 **.gitignore** 忽略的文件到Git中，但发现是添加不了的，所以我们可以使用强制添加```$ git add -f &lt;file&gt;</span><br></pre></td></tr></table></figure></p>
<p>或者我们可以检查及修改 <strong>.gitignore</strong> 文件的忽略规则：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git check-ignore -v &lt;file&gt;</span><br></pre></td></tr></table></figure>
<p>Git会告诉我们具体的 <strong>.gitignore</strong> 文件中的第几行规则忽略了该文件，这样我们就知道应该修改哪个规则了；</p>
<p>如何忽略已经提交到远程库中的文件？<br>如果你已经将一些文件提交到远程库中了，然后你想忽略掉此文件，然后在 <strong>.gitignore</strong> 文件中添加忽略，然而你会发现并没有生效，因为Git添加忽略时只有对没有跟踪的文件才生效，也就是说你没有add过和提交过的文件才生效，按如下命令：</p>
<p>比如说：我们要忽略.idea目录，先删除已经提交到本地库的文件目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rm --cached .idea</span><br></pre></td></tr></table></figure>
<p>格式：git rm –cached + 路径</p>
<p>如果提示：fatal: not removing ‘.idea’ recursively without -r</p>
<p>加个参数 -r 即可强制删除</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git rm -r --cached .idea</span><br></pre></td></tr></table></figure>
<p>然后，执行<code>git status</code>会提示你已经删除.idea目录了，然后执行commit再push就可以了，此时的.idea目录是没有被跟踪的，将.idea目录添加到 <strong>.gitignore</strong> 文件中就可以忽略了。</p>
<p>附图：</p>
<p><img src="http://img.blog.csdn.net/20180104161813543?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveGlucGVuZ2ZlaTUyMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt=""></p>
<p>好了，基本差不多了，其实常用的命令也就那么几个，如果使用多了，就熟练了，相信git给我们工作效率及工作上的提升…</p>
<p>声明：附图来自CSDN知识库，仅作为学习交流用；</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vance.xin/2017/09/24/深入浅出Retrofit2.x(一)/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="程序员飞飞">
      <meta itemprop="description" content="Android、Java Developer.">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员飞飞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/09/24/深入浅出Retrofit2.x(一)/" class="post-title-link" itemprop="url">深入浅出 Retrofit2.x (一)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-24 23:47:57" itemprop="dateCreated datePublished" datetime="2017-09-24T23:47:57+08:00">2017-09-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-12-08 23:05:39" itemprop="dateModified" datetime="2018-12-08T23:05:39+08:00">2018-12-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          
            <span id="/2017/09/24/深入浅出Retrofit2.x(一)/" class="post-meta-item leancloud_visitors" data-flag-title="深入浅出 Retrofit2.x (一)" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2017/09/24/深入浅出Retrofit2.x(一)/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/09/24/深入浅出Retrofit2.x(一)/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <center>点击上面蓝色字体关注“IT大飞说”</center>

<p><img src="http://pcobk8jbf.bkt.clouddn.com/FiXJ98D79k-dLqxfCXa4EUuFJAzt" alt=""></p>
<blockquote>
<p>在 Android 开发中，从最原生的 <strong>HttpClient</strong> 和后来的 <strong>HttpUrlConnection</strong>，再到<strong>Volley、AsyncHttpClient</strong> 等网络请求框架，最后到 Square 公司开源的 <strong>okhttp</strong>，一时间 <strong>okhttp</strong> 风靡整个开发圈，进而衍生了好多大牛对 <strong>okhttp</strong> 的封装开源库，像鸿洋大神封装的 <strong>okhttputils</strong>，还有 <strong>Okgo</strong> … 然后就是 <strong>Retrofit</strong> 了，其实它也是对 <strong>okhttp</strong> 的封装，<strong>Retrofit</strong> 使得网络请求更优雅，灵活性更高，支持各种适配器和转换器，可以搭配 <strong>RxJava</strong> 一起使用，一度后来基于 <strong>RxJava + Retrofit + MVP</strong> 这种架构设计非常流行，网上关于这种的文章也更是层出不穷，目前 <strong>retrofit</strong> 在 GitHub 上有将近 3w 的 Star，目前可以说是非常稳定了。</p>
</blockquote>
<h2 id="1-初识-Retrofit"><a href="#1-初识-Retrofit" class="headerlink" title="1.初识 Retrofit"></a>1.初识 Retrofit</h2><p>简单说，<strong>Retrofit</strong> 是一个支持 <strong>RESTful api</strong> 架构的 <strong>http</strong> 网络请求框架的封装库，<strong>Retrofit</strong> 封装了许多自定义的注解，大大方便和简化了使用，另外灵活性也更高，底层采用 <strong>okhttp</strong> 实现真正的网络请求，他们的关系可以说是分工协作吧，总结一成一句话就是：<strong>Retrofit</strong> 让 <strong>okhttp</strong> 网络请求更优雅！</p>
<p>他们的关系可以看下图可能更容易理解：</p>
<p><img src="http://pcobk8jbf.bkt.clouddn.com/FhwwxNV6ylKyjVw-T4UKttiY7DZg" alt=""></p>
<h2 id="2-小牛试刀"><a href="#2-小牛试刀" class="headerlink" title="2.小牛试刀"></a>2.小牛试刀</h2><h3 id="2-1我们先来个简单的-GET-请求"><a href="#2-1我们先来个简单的-GET-请求" class="headerlink" title="2.1我们先来个简单的 GET 请求"></a>2.1我们先来个简单的 GET 请求</h3><p>首先在 Gradle 中添加 Retrofit 的依赖：</p>
<figure class="highlight plain"><figcaption><span>'com.squareup.retrofit2:retrofit:2.3.0'```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">然后我们定义一个接口：</span><br></pre></td></tr></table></figure>
<p>public interface GithubService {</p>
<pre><code>@GET(&quot;/users/xinpengfei520&quot;)
Call&lt;ResponseBody&gt; getUserString();
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">解释一下上面接口中的注解 **@GET**，这个代表 **HTTP** 的请求类型，同理 **@POST，@PUT，@DELETE,@HEAD,@PATCH** 分别代表 POST、PUT 和 DELETE、HEAD、PATCH 请求；括号中的字符串 **&quot;/users/xinpengfei520&quot;** 代表注解 **@GET** 的值，这里指的是 URL 中的 Path，请求的时候会拼接到BASE_URL 后面，BASE_URL 在构建 Retrofit 的时候设置，**Call&lt;ResponseBody&gt;** 中的 Call 为方法的返回值类型，ResponseBody 为方法的返回值类型的泛型。</span><br><span class="line"></span><br><span class="line">接下来，我们构建一个 Retrofit 对象：</span><br></pre></td></tr></table></figure></p>
<p>Retrofit retrofit = new Retrofit.Builder()<br>                .baseUrl(“<a href="https://api.github.com&quot;" target="_blank" rel="noopener">https://api.github.com&quot;</a>)<br>                .build();<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">非常简单吧，这里使用了构建者模式，方便我们动态的配置各种参数，baseUrl 就是服务器的 HOST，一般是域名或者 ip，通常都带有端口，baseUrl 是一定要设置的，否则会抛异常 ```throw new IllegalStateException(&quot;Base URL required.&quot;)```。</span><br><span class="line"></span><br><span class="line">然后，我们来进行一个异步请求：</span><br></pre></td></tr></table></figure></p>
<pre><code>GithubService service = retrofit.create(GithubService.class);
    Call&lt;ResponseBody&gt; call = service.getUserString();
    call.enqueue(new Callback&lt;ResponseBody&gt;() {
        @Override
        public void onResponse(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response) {
            String json = response.body().string();
        }

        @Override
        public void onFailure(Call&lt;ResponseBody&gt; call, Throwable t) {

        }
    });
</code></pre><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">上面的代码中先调用 Retrofit 的 create() 方法，方法的参数就是我们定义的接口的 class，create 的内部实现是使用了 Java 中的动态代理模式，考虑到一些基础比较差的同学，关于动态代理，我这里简单的解释一下：代理类在程序运行时创建的代理方式被成为动态代理，代理类并不是在Java代码中定义的，而是在运行时在 Java 代码中动态生成的，当我们使用代理对象执行代理对象的方法时，都会被替换成执行invoke方法，在 invoke 方法中可以拿到代理对象，代理对象的方法及参数，当然这里也涉及到一些反射相关的知识，这里就不详细展开了；结合上面的代码，service 就是代理对象，当 service 调用 getUserString() 方法时，就会触发 invoke 方法，进而通过反射可以拿到代理对象，方法及参数，具体的细节就不详细讲了，感兴趣的同学可以读 Retrofit 的源码进行理解；上面代码中拿到call 后就是网络请求了，一个成功和一个失败的回调方法，这样一次完整的Retrofit的网络请求就算完了。</span><br><span class="line"></span><br><span class="line">另外我们还可以使用Retrofit的同步请求接口(注意要放在子线程中请求)：</span><br></pre></td></tr></table></figure>
<p>Response<responsebody> response = call.execute();<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 2.2 优化接口定义</span><br><span class="line"></span><br><span class="line">在上面的请求中，很明显我们定义的 GitHubService 接口中的方法的注解的值是写死的，假如我们有另一个请求的接口是 ```https://api.github.com/users/zhangsan``` 也就是说 Path 是 ```/users/zhangsan```，要想请求的话，有两种方式，在之前定义的接口中再增加一个方法，或者另外再重新定义一个接口，这样比较比较麻烦了，通用性和扩展性都不好，和之前定义的接口比较一下，只有 **users/** 后面的内容不同，我们想如果这个可以动态作为传入就好了？当然是可以的，我们可以这样写：</span><br></pre></td></tr></table></figure></responsebody></p>
<p>public interface GitHubService {<br>  @GET(“/users/{user}”)<br>  Call<responsebody> getUserString(@Path(“user”) String user);<br>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">上面代码中的user作为方法的参数传进来，并且我们使用了@Path注解，然后我们在@GET注解的值中使用 **&#123;user&#125;** 动态获取传进来的 user 的值，这样就达到了动态替换的效果，好了我们又学会了使用</span><br><span class="line">**@Path** 注解了，好棒棒！不过在使用 **@Path** 注解时应该注意一下几点:</span><br><span class="line"></span><br><span class="line">- 使用@Path时，Path对应的路径不能包含”/”，否则会将其转化为 %2F，在遇到想动态的拼接多节url时，还是使用@Url；</span><br><span class="line">- @Path只是用来做一层路径，如果路经是多层的，可以用多个@Path，或者用@Url；</span><br><span class="line">- 如果非要使用 @Path 注解来传入多层路径，那就必须指定 @Path的 encoded = true；</span><br><span class="line"></span><br><span class="line">### 2.3 进一步优化</span><br><span class="line"></span><br><span class="line">通过上面的网络请求测试，感觉和其他网络请求也没什么两样啊，除了使用了 @Path 注解外，好像发现没什么好用的地方？跟你说 Retrofit 能着呢，别人能干的它都能干，别人不能干的它也能干！先别急，我们先慢慢一步一步来了解她，慢慢的你就会发现她的美！就和有的妹子一样，见第一眼觉得不怎么样，但是处的时间长了，你就会发现她越来越漂亮，越看越美...</span><br><span class="line"></span><br><span class="line">Retrofit 可以灵活的配置各种转换器，转换器什么鬼？通俗地讲，转换器的意思就是把一种数据类型解析并转换成另一种数据类型，现在不理解没关系，往后面看你就会明白，Retrofit支持的转换器有：</span><br><span class="line"></span><br><span class="line">1. Gson: com.squareup.retrofit2:converter-gson</span><br><span class="line">2. Jackson: com.squareup.retrofit2:converter-jackson</span><br><span class="line">3. Moshi: com.squareup.retrofit2:converter-moshi</span><br><span class="line">4. Protobuf: com.squareup.retrofit2:converter-protobuf</span><br><span class="line">5. Wire: com.squareup.retrofit2:converter-wire</span><br><span class="line">6. Simple XML: com.squareup.retrofit2:converter-simplexml</span><br><span class="line">7. Scalars (primitives, boxed, and String): com.squareup.retrofit2:converter-scalars</span><br><span class="line"></span><br><span class="line">一般情况下，我们使用 Gson 转换器比较多一些，现在我们就来试试转换器的威力吧。</span><br><span class="line"></span><br><span class="line">首先在 Gradle 中添加依赖:</span><br><span class="line"></span><br><span class="line">```implementation &apos;com.squareup.retrofit2:converter-gson:2.3.0&apos;</span><br></pre></td></tr></table></figure></responsebody></p>
<p>接下来我们在创建Retrofit 对象的时候设置它的转换器，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">                .baseUrl(&quot;https://api.github.com&quot;)</span><br><span class="line">				.addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">                .build();</span><br></pre></td></tr></table></figure>
<p>然后我们创建一个实体类 GithubUserBean，这个类其实就是上面接口返回数据对应的实体类，我们直接用 GsonFormat 插件自动生成即可。</p>
<p>下一步，我们再修改接口中返回值类型的泛型，修改后如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public interface GithubService &#123;</span><br><span class="line"></span><br><span class="line">    @GET(&quot;/users/&#123;user&#125;&quot;)</span><br><span class="line">    Call&lt;GithubUserBean&gt; getUserString(@Path(&quot;user&quot;) String user);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后，我们再来发起一个异步请求：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">GithubService service = retrofit.create(GithubService.class);</span><br><span class="line">       Call&lt;GithubUserBean&gt; call = service.getUserString(&quot;xinpengfei520&quot;);</span><br><span class="line">       call.enqueue(new Callback&lt;GithubUserBean&gt;() &#123;</span><br><span class="line">           @Override</span><br><span class="line">           public void onResponse(Call&lt;GithubUserBean&gt; call, Response&lt;GithubUserBean&gt; response) &#123;</span><br><span class="line">			GithubUserBean userBean = response.body();</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           @Override</span><br><span class="line">           public void onFailure(Call&lt;GithubUserBean&gt; call, Throwable t) &#123;</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br></pre></td></tr></table></figure>
<p>看上面的代码，仔细的你可能已经发现了，当请求接口成功时，我们拿到的直接就是对应的实体类了，不需要再解析了，这是因为 Retrofit 内部会根据这个转换工厂及返回数据所指定的泛型自动帮你直接转换成Bean了，就问你爽不爽？怎一个爽字了得？简直帅呆了！有木有？</p>
<p>注意：接口中返回值类型Call的泛型要么是 ResponseBody，要么是实体类，不支持其他类型！ResponseBody 的子类也不行！</p>
<p>本来打算写一两篇文章来介绍 Retrofit 的，结果发现一两篇文章的根本讲不清楚，因为涉及的知识比较多，另一方面如果是一两篇文章的话，可能篇幅比较长，读者很难坚持读下去，还有我写的时候考虑的东西也比较多，我觉得我的文章应该是面向大众的，尽可能覆盖到大多数的读者，包括一些初学者，由浅入深，由粗到细，这样才能便于大家更好的学习理解，文章中一些东西比较基础，对于觉得会的简单的直接跳过即可，后面的系列文章，我会写一些比较进阶的用法，从源码角度进行分析，便于大家更好的理解。</p>
<p>好了，今天的分享就到这里，我还是你们的大飞哥，一个不止会敲代码的厨师！</p>
<p>推荐阅读：<br><a href="https://mp.weixin.qq.com/s/ReJJFmQm6l55r9pvo7aFIA" target="_blank" rel="noopener">给大家推荐一个神器</a><br><a href="https://mp.weixin.qq.com/s/3GlXPLakrVhuq74gOk1wmQ" target="_blank" rel="noopener">MySQL8.0设置远程访问权限</a><br><a href="https://mp.weixin.qq.com/s/H8WqFy2RPYZWRpp63oBPfQ" target="_blank" rel="noopener">不得不会的10点Java基础知识</a><br><a href="https://mp.weixin.qq.com/s/EwD4Tp9zvaHFfZ17ayTksg" target="_blank" rel="noopener">CentOS7 重置 MySQL 8.0 密码</a>  </p>
<center>大飞哥，带你飞，关注大飞不迷路!</center><br><center><img src="http://pcobk8jbf.bkt.clouddn.com/FijAsROsRHuwVUivQ8M9D5o3RSdP" alt=""></center><br><center>可能不是最好的公众号，但肯定是最良心的公众号!</center>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vance.xin/2017/09/24/深入浅出Retrofit2.x(二)/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="程序员飞飞">
      <meta itemprop="description" content="Android、Java Developer.">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员飞飞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/09/24/深入浅出Retrofit2.x(二)/" class="post-title-link" itemprop="url">深入浅出 Retrofit2.x (二)</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-24 23:47:57" itemprop="dateCreated datePublished" datetime="2017-09-24T23:47:57+08:00">2017-09-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-12-08 23:05:23" itemprop="dateModified" datetime="2018-12-08T23:05:23+08:00">2018-12-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          
            <span id="/2017/09/24/深入浅出Retrofit2.x(二)/" class="post-meta-item leancloud_visitors" data-flag-title="深入浅出 Retrofit2.x (二)" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2017/09/24/深入浅出Retrofit2.x(二)/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/09/24/深入浅出Retrofit2.x(二)/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <center>点击上面蓝色字体关注<span style="color:#0000ff;">“IT大飞说”</span></center><center>置顶公众号（<strong>ID：ITBigFly</strong>）第一时间收到推送</center><br><img src="http://pcobk8jbf.bkt.clouddn.com/FhaQ3TFtgnEnaDxOllrIjS-VPTAn" alt=""><br>&gt;上一篇文章<a href="https://mp.weixin.qq.com/s/jxBEg7dpFfTNLXNFdvJjrw" target="_blank" rel="noopener">深入浅出Retrofit2.x(一)</a>中，我们讲解了 <strong>Retrofit</strong> 的最基本用法，以及 <strong>GET</strong> 请求示例，非常简单，相信大家都已经会使用了，本篇文章将继续介绍 <strong>Retrofit</strong> 的一些其他的一些常用用法，主要围绕如何使用 <strong>POST</strong> 请求提交表单数据，提交 <strong>json</strong> 字符串作为请求体，还有一些 <strong>Retrofit</strong> 的相关注解介绍等。<br><br>## 1.POST 请求我最行<br><br>大家在和服务交互的时候，大多情况下都应该使用的是 <strong>GET、POST</strong> 请求吧，下面我们就对 <strong>POST</strong> 各种数据类型及如何定义接口进行说明。<br><br>### 1.1 POST 提交表单数据<br><br>首先定义一个如下接口，如果是单参数或者是双参数的话可以这么写：<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@FormUrlEncoded</span><br><span class="line">@POST(&quot;/&quot;)</span><br><span class="line">Call&lt;ResponseBody&gt; postFormData(</span><br><span class="line">    @Field(&quot;name&quot;) String name,</span><br><span class="line">    @Field(&quot;occupation&quot;) String occupation);</span><br></pre></td></tr></table></figure><br><br>如果参数较多的话可以使用 <strong>@FieldMap</strong> 注解<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 提交 FORM 表单数据</span><br><span class="line">@FormUrlEncoded</span><br><span class="line">@POST(&quot;&#123;url&#125;&quot;)</span><br><span class="line">Call&lt;ResponseBody&gt; postFormData(</span><br><span class="line">        @Path(&quot;url&quot;) String url,</span><br><span class="line">        @FieldMap Map&lt;String, String&gt; params);</span><br></pre></td></tr></table></figure><br><br>另外 <strong>@Field</strong> 和 <strong>@FieldMap</strong> 也可以结合在一起使用。<br><br>### 1.2 POST 提交 Json 数据<br><br>我们大多数情况下，发送 <strong>POST</strong> 请求都是提交 <strong>Json</strong> 数据和服务器进行交互，而 <strong>Json</strong> 数据的序列化方式也有多种，我们可以先把对象序列化成 <strong>Json</strong> 再提交，也可以直接传入一个 <strong>Map</strong> 参数集合等等都是可以的，看似我们没有序列化，其实内部已经帮我自动实现了序列化的过程，对于不同的参数类型，我们索性就定义一个比较通用的 <strong>ApiService</strong> 接口，然后把常用的各种请求方式、文件的上传下载等，以及不同参数类型的方法进行封装，把动态变化的参数暴露给外面，让外部传入即可，接口定义如下，每个方法我都加了注释，看注释就好。<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by x-sir on 2018/8/1 :)</span><br><span class="line"> * Function:</span><br><span class="line"> */</span><br><span class="line">public interface ApiService &#123;</span><br><span class="line"></span><br><span class="line">    // GET 无参数请求</span><br><span class="line">    @GET(&quot;&#123;url&#125;&quot;)</span><br><span class="line">    Call&lt;ResponseBody&gt; getRequest(</span><br><span class="line">            @Path(&quot;url&quot;) String url);</span><br><span class="line"></span><br><span class="line">    // GET 带参数请求</span><br><span class="line">    @GET(&quot;&#123;url&#125;&quot;)</span><br><span class="line">    Call&lt;ResponseBody&gt; getMapParam(</span><br><span class="line">            @Path(&quot;url&quot;) String url,</span><br><span class="line">            @QueryMap Map&lt;String, String&gt; maps);</span><br><span class="line"></span><br><span class="line">    //  POST Map body 请求</span><br><span class="line">    @Headers(&#123;&quot;Content-Type: application/json&quot;, &quot;Accept: application/json&quot;&#125;)</span><br><span class="line">    @POST(&quot;&#123;url&#125;&quot;)</span><br><span class="line">    Call&lt;ResponseBody&gt; postMapBody(</span><br><span class="line">            @Path(value = &quot;url&quot;, encoded = true) String url,</span><br><span class="line">            @Body Map&lt;String, String&gt; maps);</span><br><span class="line"></span><br><span class="line">    // POST RequestBody 必须要设置 encoded = true, 否则 url 有编码问题</span><br><span class="line">    // 使用@Path时，path对应的路径不能包含”/”，否则会将其转化为%2F，在遇到想动态的拼接多节url时，还是使用@Url吧</span><br><span class="line">    @Headers(&#123;&quot;Content-Type:application/json&quot;, &quot;Accept:application/json&quot;&#125;)</span><br><span class="line">    @POST(&quot;&#123;url&#125;&quot;)</span><br><span class="line">    Call&lt;ResponseBody&gt; postRequestBody(</span><br><span class="line">            @Path(value = &quot;url&quot;, encoded = true) String url,</span><br><span class="line">            @Body RequestBody body);</span><br><span class="line"></span><br><span class="line">    //  POST Url body 请求(适用于动态域名访问，当url为全域名时，会使用url的全域访问，当为非全域时，会拼接到BASE_URL的后面)</span><br><span class="line">    @Headers(&#123;&quot;Content-Type: application/json&quot;, &quot;Accept: application/json&quot;&#125;)</span><br><span class="line">    @POST</span><br><span class="line">    Call&lt;ResponseBody&gt; postUrlBody(</span><br><span class="line">            @Url String url,</span><br><span class="line">            @Body Map&lt;String, String&gt; maps);</span><br><span class="line"></span><br><span class="line">    // 提交 FORM 表单数据</span><br><span class="line">    @FormUrlEncoded</span><br><span class="line">    @POST(&quot;&#123;url&#125;&quot;)</span><br><span class="line">    Call&lt;ResponseBody&gt; postFormData(</span><br><span class="line">            @Path(&quot;url&quot;) String url,</span><br><span class="line">            @FieldMap Map&lt;String, String&gt; params);</span><br><span class="line"></span><br><span class="line">    // 单文件/图片上传</span><br><span class="line">    @Multipart</span><br><span class="line">    @POST(&quot;&#123;url&#125;&quot;)</span><br><span class="line">    Observable&lt;ResponseBody&gt; upLoadFile(</span><br><span class="line">            @Path(&quot;url&quot;) String url,</span><br><span class="line">            @Part(&quot;image\&quot;; filename=\&quot;image.jpg&quot;) RequestBody requestBody);</span><br><span class="line"></span><br><span class="line">    // 多文件/图片上传</span><br><span class="line">    @POST(&quot;&#123;url&#125;&quot;)</span><br><span class="line">    Call&lt;ResponseBody&gt; uploadFiles(</span><br><span class="line">            @Path(&quot;url&quot;) String url,</span><br><span class="line">            @Path(&quot;headers&quot;) Map&lt;String, String&gt; headers,</span><br><span class="line">            @Part(&quot;filename&quot;) String description,</span><br><span class="line">            @PartMap() Map&lt;String, RequestBody&gt; maps);</span><br><span class="line"></span><br><span class="line">    // 文件下载</span><br><span class="line">    @Streaming</span><br><span class="line">    @GET</span><br><span class="line">    Observable&lt;ResponseBody&gt; downloadFile(</span><br><span class="line">            @Url String fileUrl);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>然后我们先发送一个 <strong>POST</strong> 请求，是将 <strong>json</strong> 串作为请求体，接口的参数类型是一个 <strong>Map</strong> 集合：<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">                .baseUrl(&quot;https://api.example.com&quot;)</span><br><span class="line">				.addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">ApiService service = retrofit.create(ApiService.class);</span><br><span class="line">        Call&lt;ResponseBody&gt; call = service.postMapBody(url, map);</span><br><span class="line">        call.enqueue(new Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onResponse(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response) &#123;</span><br><span class="line">				String json = response.body().string();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onFailure(Call&lt;ResponseBody&gt; call, Throwable t) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure><br><br>同样的我们想使用 <strong>Post</strong> 提交 <strong>Form</strong> 表单数据，就只需要调用 <strong>ApiService</strong> 的 <strong>postFormData</strong> 方法即可，其他不用变，这样做的好处是不用定义多个 <strong>Service</strong> 了，只需要定义一个<strong> ApiService</strong> 就可以满足了所有参数类型的请求了，另外 <strong>POST</strong> 还可以支持直接传入一个 <strong>RequestBody</strong> 类型的参数，我们可以直接将对象转换为 <strong>RequestBody</strong> 对象，然后再请求即可，转化的话我们可以定义一个工具类来实现：<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Created by x-sir on 2018/8/3 :)</span><br><span class="line"> * Function:</span><br><span class="line"> */</span><br><span class="line">public class Converter &#123;</span><br><span class="line"></span><br><span class="line">    public static RequestBody toBody(Object object) &#123;</span><br><span class="line">        return RequestBody.create(MediaType.parse(&quot;application/json; charset=utf-8&quot;),</span><br><span class="line">                new Gson().toJson(object));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><br>我们来个请求的示例：<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">                .baseUrl(&quot;https://api.example.com&quot;)</span><br><span class="line">				.addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">ApiService service = retrofit.create(ApiService.class);</span><br><span class="line">        Call&lt;ResponseBody&gt; call = service.postRequestBody(url, Converter.toBody(map));</span><br><span class="line">        call.enqueue(new Callback&lt;ResponseBody&gt;() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onResponse(Call&lt;ResponseBody&gt; call, Response&lt;ResponseBody&gt; response) &#123;</span><br><span class="line">				String json = response.body().string();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onFailure(Call&lt;ResponseBody&gt; call, Throwable t) &#123;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure><br><br>## 2.GET 请求之 @Query 和 @QueryMap 注解<br><br><strong>@Query</strong> 其实相当于我们在请求时 <strong>Url</strong> 中 <strong>‘?’</strong> 后面的 <strong>key-value</strong>，例如：<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://api.github.com/?page=1</span><br></pre></td></tr></table></figure><br><br>我们就可以这样来定义接口了<br><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@GET(&quot;/list&quot;)</span><br><span class="line">Call&lt;ResponseBody&gt; getPageData(@Query(&quot;page&quot;) int page);</span><br></pre></td></tr></table></figure><br><br>这里的 <strong>page=1</strong> 就是一个 <strong>@Query</strong>，如果我有多个 <strong>@Query</strong>，我们可以使用 <strong>@QueryMap</strong> 使用方法很简单，我就不多说了。<br><br>## 3.Retrofit 注解<br><br>我们都知道，在 <strong>Retrofit</strong> 中，大量使用了注解，这样做的好处是可以简化请求，通过各种不同的注解来进行灵活的配置，另外也可以达到解耦的目的，所以说 <strong>Retrofit</strong> 的设计很美很优雅， <strong>Retrofit</strong> 的注解大体分为以下几类：<br><br>1. 用于标注请求方式的注解；<br>2. 用于标记请求头的注解；<br>3. 用于标记请求参数的注解；<br>4. 用于标记请求和响应格式的注解；<br><br>### 3.1 请求方法注解<br><br>|注解|说明|<br>| —— | —— |<br>|@GET|GET 请求|<br>|@POST|POST 请求|<br>|@PUT|PUT 请求|<br>|@DELETE|DELETE 请求|<br>|@PATCH|PATCH 请求，对 PUT 请求的补充，用于更新局部资源|<br>|@HEAD|HEAD 请求|<br>|@OPTION|OPTION 请求|<br>|@HTTP|通用注解，可以替换以上所有的注解，其拥有三个属性：method、path、hasBody|<br><br>### 3.2 请求头注解<br><br>|注解|说明|<br>| —— | —— |<br>|@Headers|添加固定请求头，可以同时添加多个并且不会相互覆盖原有的请求头，而是共同存在|<br>|@Header|作为方法的参数传入，用于添加不固定值的 Header，该注解会更新覆盖已有的请求头|<br><br>### 3.3 请求参数注解<br><br>|注解|说明|<br>| —— | —— |<br>|@Body|多用于 POST 请求发送非表单数据,比如想要以 POST 方式传递 json 格式数据|<br>|@Filed|多用于 POST 请求中表单字段，@Filed 和 @FieldMap 需要与 @FormUrlEncoded 注解结合使用|<br>|@FiledMap|和 @Filed 作用一致，用于不确定表单参数|<br>|@Part|用于表单字段,@Part 和 @PartMap 与 @Multipart 注解结合使用,适合文件上传的情况|<br>|@PartMap|用于表单字段,默认接受的类型是 Map，可用于实现多文件上传|<br>|@Path|用于 url 中的占位符|<br>|@Query|用于 GET 请求的 url 中指定 key=value 参数|<br>|@QueryMap|和 @Query 使用类似|<br>|@Url|指定请求路径，可以是全路径和相对路径|<br><br>### 3.4 请求和响应格式注解<br><br>|注解|说明|<br>| —— | —— |<br>|@FormUrlEncoded|表示请求发送编码表单数据，每个键值对需要使用 @Field 注解|<br>|@Multipart|表示请求发送 Multipart 数据，需要配合使用 @Part|<br>|@Streaming|表示响应用字节流的形式返回，如果没使用该注解，默认会把数据全部载入到内存中，该注解在在下载大文件的特别有用|<br><br>好了，前两篇的分享已经完了，主要是围绕 Retrofit 最常用最基本的用法来展开讲解的，相信大部分读者看完都已经会用了，大家可能已经看出来这样的代码还是不太好用，没有一些设计的思想，代码比较冗余，下一篇文章将开始讲解如何进行封装一个通用的 Retrofit，这样我们就可以进行方便的进行使用了，提高了代码的复用性和封装性，以及通用性，敬请期待吧！<br><br><strong>猜你喜欢：</strong><br><a href="https://mp.weixin.qq.com/s/ReJJFmQm6l55r9pvo7aFIA" target="_blank" rel="noopener">给大家推荐一个神器</a><br><a href="https://mp.weixin.qq.com/s/jxBEg7dpFfTNLXNFdvJjrw" target="_blank" rel="noopener">深入浅出Retrofit2.x(一)</a><br><a href="https://mp.weixin.qq.com/s/H8WqFy2RPYZWRpp63oBPfQ" target="_blank" rel="noopener">不得不会的10点Java基础知识</a><br><a href="https://mp.weixin.qq.com/s/hVhhDdr3Bo4qLIdOkHsM_Q" target="_blank" rel="noopener">Android 最全 Intent 传递数据姿势</a><br><br><img src="http://pcobk8jbf.bkt.clouddn.com/Fr_08YggSBgBwGhjjZsX8bH8JYNR" alt=""><br><center><span style="color:#bdbdbd;">欢迎扫码关注我的公众号</span></center>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vance.xin/2017/09/24/用起来贼爽的Android Studio插件推荐/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="程序员飞飞">
      <meta itemprop="description" content="Android、Java Developer.">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员飞飞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/09/24/用起来贼爽的Android Studio插件推荐/" class="post-title-link" itemprop="url">用起来贼爽的 Android Studio 插件推荐</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-24 23:47:57" itemprop="dateCreated datePublished" datetime="2017-09-24T23:47:57+08:00">2017-09-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-12-08 23:07:29" itemprop="dateModified" datetime="2018-12-08T23:07:29+08:00">2018-12-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          
            <span id="/2017/09/24/用起来贼爽的Android Studio插件推荐/" class="post-meta-item leancloud_visitors" data-flag-title="用起来贼爽的 Android Studio 插件推荐" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2017/09/24/用起来贼爽的Android Studio插件推荐/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/09/24/用起来贼爽的Android Studio插件推荐/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>自从从Eclipse转到Android Studio之后，就越来越感觉用的越来越喜欢越来越爽，因为Android Studio支持很多很强大功能的各种插件，除此之外还有Android Studio本身的一些强大功能，而Eclipse是与之不能媲美的，今天的主题是主要给大家介绍一些好用、常用、实用的一些Android Studio插件，接下来我就给大家挨个介绍一下把。</p>
</blockquote>
<p>##1.Android ButterKnife Zelezny</p>
<p>用过的同志肯定知道使用的酸爽了吧，配合ButterKnife实现注解，自动初始化控件，从此就不用写findViewById了，想着就很爽啊，在Activity，Fragment，Adapter中实现布局xml一键自动生成butterknife注解。</p>
<p>使用步骤：<br>1.Android Studio中点击File -&gt; Setting -&gt; Plugin搜索 <strong>Android ButterKnife Zelezny</strong> 点击安装，完成后重启Android Studio;  </p>
<p><img src="http://img.blog.csdn.net/20171017000856835?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveGlucGVuZ2ZlaTUyMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>2.在工程的build.gradle中的<strong>dependencies</strong>节点中添加 <strong>‘com.neenbedankt.gradle.plugins:android-apt:1.8’</strong>依赖；<br>3.在app的build.gradle中的顶部第二行添加这句<strong>apply plugin: ‘com.neenbedankt.android-apt’</strong>；<br>4.然后在<strong>dependencies</strong>节点中添加两个依赖库：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;com.jakewharton:butterknife:8.4.0&apos;</span><br><span class="line">   // 添加依赖</span><br><span class="line">   apt &apos;com.jakewharton:butterknife-compiler:8.4.0&apos;</span><br><span class="line">   // 添加apt</span><br></pre></td></tr></table></figure>
<p>5.将鼠标光标放在要生成初始化控件的布局处，然后使用Ctrl+Shift+B选择生成Butterknife注解（每个人的快捷键可能不一样），详情见下图↓</p>
<p><img src="http://img.blog.csdn.net/20171017000958175?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveGlucGVuZ2ZlaTUyMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>生成完后的代码效果如下：</p>
<p><img src="http://img.blog.csdn.net/20171017001041913?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveGlucGVuZ2ZlaTUyMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>##2.GsonFormat</p>
<p>GsonFormat是一个快速将json字符串生成一个JavaBean的插件，免去我们根据json字符串手动写对应JavaBean的过程，而且还支持序列化自动生成。</p>
<p>使用方法：<br>1.安装插件，和之前的安装方法一样，搜索安装即可；<br>2.新建一个实体类，然后使用快捷键Alt+Shift+S弹出选择菜单，选择<strong>GsonFormat</strong>,然后会弹出一个窗口，如下图：</p>
<p><img src="http://img.blog.csdn.net/20171017001233599?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveGlucGVuZ2ZlaTUyMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>将json串复制到下图框内：</p>
<p><img src="http://img.blog.csdn.net/20171017001304212?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveGlucGVuZ2ZlaTUyMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>最后点击ok即可，当然我们一般显示点击fromat格式化一下，方便查看，如果有错误或者说少花括号就很容易看出来，json格式错误也会有提示，另外还可以设置使用那种解析json的库比如Gson、Jackson、FastJson等。</p>
<p>##3.ADB WIFI</p>
<p>ADB WIFI是一款使用wifi无线调试你的app的插件，手机无需root权限，就可以很方便地进行无线调试你的应用了，前提是手机和电脑要连接到同一个局域网内。</p>
<p>使用步骤：<br>1.安装插件，和之前的安装方法一样，搜索安装即可；<br>2.先用数据线连接到你要调试应用的手机，然后点击Android Studio导航栏的Tools具体操作如下图↓</p>
<p><img src="http://img.blog.csdn.net/20171017001414340?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveGlucGVuZ2ZlaTUyMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>3.拔掉数据线，点击运行，你就会看到你的手机了，然后你就可以尽情的无线调试应用了，是不是很爽？</p>
<p>##4.FindBugs-IDEA</p>
<p>FindBugs-IDEA是一款查找代码中bug的代码审查插件，它可以找出你代码中的一些缺陷和有问题的地方，进而你可以进行代码的优化处理。</p>
<p>使用方法：<br>1.安装插件，和之前的安装方法一样，搜索安装即可；<br>2.选中你想要审查的代码的文件名或者包名，然鼠标点击右键，我们可以选择整个包，单个类文件或者真个module去进行分析；</p>
<p><img src="http://img.blog.csdn.net/20171017001503339?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveGlucGVuZ2ZlaTUyMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>3.静静地等一会，分析完之后我们就可以看到有bug的地方就会标注出来，接下来我们就去改这些地方就可以了，当然有些也算不算bug，影响不大我们可以不用改了，但是我们尽量在写代码的时候尽量养成一个良好的编码习惯，这样我们就可以提高编码的质量和效率。</p>
<p>下图就是分析完之后的效果：</p>
<p><img src="http://img.blog.csdn.net/20171017001536053?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveGlucGVuZ2ZlaTUyMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>##5.ETCTranslation</p>
<p>ETCTranslation是一个可以对Android Studio中的英文进行翻译的插件，我们在看源码及英文注释的时候，就不用再去查字典了，可以设置鼠标悬停翻译，也可自定义快捷键，这样方便多了。<br>下载地址：<a href="https://github.com/Skykai521/ECTranslation" target="_blank" rel="noopener">https://github.com/Skykai521/ECTranslation</a><br>安装的时候可以将jar包下载下来导入安装即可。</p>
<p>使用效果如下图：</p>
<p><img src="http://img.blog.csdn.net/20171017001603309?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveGlucGVuZ2ZlaTUyMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>##6.Android Parcelable Code Generator</p>
<p>Android中的序列化有两种方式，分别是实现Serializable接口和Parcelable接口，一般推荐使用Parcelable，只不过我们这种方式要比Serializable方式要繁琐，因此，这个插件就很轻松地帮你实现了。</p>
<p>使用效果如下：</p>
<p><img src="http://img.blog.csdn.net/20171017001622406?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveGlucGVuZ2ZlaTUyMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>##7.SelectorChapek for Android</p>
<p>这是一个非常酷炫的插件，它可以根据一定命名规则的图片来生成出对应空间的选择器的xml，比如点击按钮的选择器以及按下等效果，有了它从此你的生活就可以自理了。</p>
<p><img src="http://img.blog.csdn.net/20171017001656838?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveGlucGVuZ2ZlaTUyMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>##8.AndroidProguardPlugin</p>
<p>AndroidProguardPlugin是一个一键生成项目混淆规则代码的插件，它可以很方便的进行个各种开源库及常用混淆配置，安装方法及下载地址如下：<br>下载地址：<a href="https://github.com/zhonghanwen/AndroidProguardPlugin" target="_blank" rel="noopener">https://github.com/zhonghanwen/AndroidProguardPlugin</a></p>
<p>使用步骤：<br>安装完插件之后点击Android Studio导航栏的Edit -&gt; AndroidProGuard即可，弹出对话框后点击ok,如下图：</p>
<p><img src="http://img.blog.csdn.net/20171017001751352?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveGlucGVuZ2ZlaTUyMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>然后打开混淆文件的<strong>proguard-rules.pro</strong>，然后Ctrl + V粘贴即可，最后根据你的项目具体修改文件中报红的地方即可。</p>
<p>##9.Android Postfix completion</p>
<p>Android Postfix completion是一个可以自动根据后缀快速完成代码的插件，它强大的自动预览及补全，从此可以很快速、很愉快的coding了…</p>
<p>插件下载地址：<a href="https://plugins.jetbrains.com/plugin/7775?pr=" target="_blank" rel="noopener">https://plugins.jetbrains.com/plugin/7775?pr=</a></p>
<p>插件教程地址：<a href="http://blog.jetbrains.com/idea/2014/03/postfix-completion/" target="_blank" rel="noopener">http://blog.jetbrains.com/idea/2014/03/postfix-completion/</a></p>
<p>下图为弹出一个Toast内容为“hello”,你只需输入“hello”.to就会弹出提示，然后选中后回车即可。</p>
<p><img src="http://img.blog.csdn.net/20171017001822078?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveGlucGVuZ2ZlaTUyMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>##10.codota</p>
<p>codota是一个强大的搜索开源库及代码的插件，它搜集了大量的代码，据说有超过700W的代码实例，另外还提供了Chrome和As插件可供下载。</p>
<p>插件下载地址：<a href="https://plugins.jetbrains.com/plugin/7638?pr=" target="_blank" rel="noopener">https://plugins.jetbrains.com/plugin/7638?pr=</a></p>
<p>插件官方网址：<a href="https://www.codota.com/" target="_blank" rel="noopener">https://www.codota.com/</a></p>
<p><img src="http://img.blog.csdn.net/20171017001858356?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQveGlucGVuZ2ZlaTUyMQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"></p>
<p>好了，今天的推荐就到这里了，如果你觉得本文对你有帮助，欢迎收藏，欢迎点赞，码字不易，且行且珍惜！</p>
<p>注：本文为作者原创，转载请注明出处，谢谢！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vance.xin/2017/09/24/Android EasyPermission优雅地实现动态权限申请/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="程序员飞飞">
      <meta itemprop="description" content="Android、Java Developer.">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员飞飞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/09/24/Android EasyPermission优雅地实现动态权限申请/" class="post-title-link" itemprop="url">Android EasyPermission 优雅地实现动态权限申请</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-24 23:47:57" itemprop="dateCreated datePublished" datetime="2017-09-24T23:47:57+08:00">2017-09-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-12-08 23:10:48" itemprop="dateModified" datetime="2018-12-08T23:10:48+08:00">2018-12-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          
            <span id="/2017/09/24/Android EasyPermission优雅地实现动态权限申请/" class="post-meta-item leancloud_visitors" data-flag-title="Android EasyPermission 优雅地实现动态权限申请" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2017/09/24/Android EasyPermission优雅地实现动态权限申请/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/09/24/Android EasyPermission优雅地实现动态权限申请/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Google开源的动态权限适配库，用起来比较简洁和清晰，总体还不错，如果喜欢链式调用的就用 <strong>RxPermission</strong> 或者 <strong>AndPermission</strong> 都是不错的选择。</p>
<p>##一、权限等级和权限组介绍</p>
<p>权限主要分为 <strong>normal</strong> 、<strong>dangerous</strong>、<strong>signature</strong> 和 <strong>signatureOrSystem</strong>四个等级，一般情况下，我们只需要了解前两种权限的使用就可以了，后面的是属于系统级签名的权限。</p>
<p>##二、普通权限和危险权限</p>
<p>普通权限只需要在AndroidMenifest.xml文件中申请即可，危险权限需要到代码中进行动态申请一般是成对成组地去申请，所以叫权限组</p>
<p>普通权限对应表：</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Permission</th>
</tr>
</thead>
<tbody>
<tr>
<td>ACCESS_LOCATION_EXTRA_COMMANDS</td>
<td>ACCESS_NETWORK_STATE</td>
</tr>
<tr>
<td>ACCESS_NOTIFICATION_POLICY</td>
<td>ACCESS_WIFI_STATE</td>
</tr>
<tr>
<td>BLUETOOTH</td>
<td>BLUETOOTH_ADMIN</td>
</tr>
<tr>
<td>BROADCAST_STICKY</td>
<td>CHANGE_NETWORK_STATE</td>
</tr>
<tr>
<td>CHANGE_WIFI_MULTICAST_STATE</td>
<td>CHANGE_WIFI_STATE</td>
</tr>
<tr>
<td>DISABLE_KEYGUARD</td>
<td>EXPAND_STATUS_BAR</td>
</tr>
<tr>
<td>GET_PACKAGE_SIZE</td>
<td>INSTALL_SHORTCUT</td>
</tr>
<tr>
<td>INTERNET</td>
<td>KILL_BACKGROUND_PROCESSES</td>
</tr>
<tr>
<td>MODIFY_AUDIO_SETTINGS</td>
<td>NFC</td>
</tr>
<tr>
<td>READ_SYNC_SETTINGS</td>
<td>READ_SYNC_STATS</td>
</tr>
<tr>
<td>RECEIVE_BOOT_COMPLETED</td>
<td>REORDER_TASKS</td>
</tr>
<tr>
<td>REQUEST_IGNORE_BATTERY_OPTIMIZATIONS</td>
<td>REQUEST_INSTALL_PACKAGES</td>
</tr>
<tr>
<td>SET_ALARM</td>
<td>SET_TIME_ZONE</td>
</tr>
<tr>
<td>SET_WALLPAPER</td>
<td>SET_WALLPAPER_HINTS</td>
</tr>
<tr>
<td>TRANSMIT_IR</td>
<td>UNINSTALL_SHORTCUT</td>
</tr>
<tr>
<td>USE_FINGERPRINT</td>
<td>VIBRATE</td>
</tr>
<tr>
<td>WAKE_LOCK</td>
<td>WRITE_SYNC_SETTINGS</td>
</tr>
</tbody>
</table>
<p>危险权限对应表：</p>
<table><br><thead><br><tr><br>  <th align="left">权限组</th><br>  <th align="left">权限</th><br></tr><br></thead><br><tbody><tr><br>  <td align="left">CALENDAR</td><br>  <td align="left">READ_CALENDAR<br> WRITE_CALENDAR</td><br></tr><br><tr><br>  <td align="left">CAMERA</td><br>  <td align="left">CAMERA</td><br></tr><br><tr><br>  <td align="left">CONTACTS</td><br>  <td align="left">READ_CONTACTS<br> WRITE_CONTACTS<br> GET_ACCOUNTS</td><br></tr><br><tr><br>  <td align="left">LOCATION</td><br>  <td align="left">ACCESS_FINE_LOCATION<br> ACCESS_COARSE_LOCATION</td><br></tr><br><tr><br>  <td align="left">MICROPHONE</td><br>  <td align="left">RECORD_AUDIO</td><br></tr><br><tr><br>  <td align="left">PHONE</td><br>  <td align="left">READ_PHONE_STATE<br> CALL_PHONE<br> READ_CALL_LOG<br> WRITE_CALL_LOG<br> ADD_VOICEMAIL<br> USE_SIP<br> PROCESS_OUTGOING_CALLS</td><br></tr><br><tr><br>  <td align="left">SENSORS</td><br>  <td align="left">BODY_SENSORS</td><br></tr><br><tr><br>  <td align="left">SMS</td><br>  <td align="left">SEND_SMS<br> RECEIVE_SMS<br> READ_SMS<br> RECEIVE_WAP_PUSH<br> RECEIVE_MMS</td><br></tr><br><tr><br>  <td align="left">STORAGE</td><br>  <td align="left">READ_EXTERNAL_STORAGE<br> WRITE_EXTERNAL_STORAGE</td><br></tr><br></tbody></table>

<p>下面简单介绍一下EasyPermission的简单使用，更多详细使用请参考：<a href="https://github.com/googlesamples/easypermissions" target="_blank" rel="noopener">https://github.com/googlesamples/easypermissions</a></p>
<p>##1.添加依赖库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;pub.devrel:easypermissions:1.0.1&apos;</span><br></pre></td></tr></table></figure>
<p>##2.定义需要动态申请的权限集合</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">    * 需要申请的权限数组</span><br><span class="line">    */</span><br><span class="line">   protected String[] needPermissions = &#123;</span><br><span class="line">           Manifest.permission.WRITE_EXTERNAL_STORAGE,</span><br><span class="line">           Manifest.permission.READ_EXTERNAL_STORAGE,</span><br><span class="line">   &#125;;</span><br></pre></td></tr></table></figure>
<p>##3.重写回调方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">   public void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) &#123;</span><br><span class="line">       super.onRequestPermissionsResult(requestCode, permissions, grantResults);</span><br><span class="line"></span><br><span class="line">       // Forward results to EasyPermissions</span><br><span class="line">       EasyPermissions.onRequestPermissionsResult(requestCode, permissions, grantResults, this);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>##4.授权成功和失败的回调</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@AfterPermissionGranted(RC_CAMERA_AND_LOCATION)</span><br><span class="line">private void methodRequiresTwoPermission() &#123;</span><br><span class="line">    String[] perms = &#123;Manifest.permission.CAMERA, Manifest.permission.ACCESS_FINE_LOCATION&#125;;</span><br><span class="line">    if (EasyPermissions.hasPermissions(this, perms)) &#123;</span><br><span class="line">        // Already have permission, do the thing</span><br><span class="line">        // ...</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        // Do not have permissions, request them now</span><br><span class="line">        EasyPermissions.requestPermissions(this, getString(R.string.camera_and_location_rationale),</span><br><span class="line">                RC_CAMERA_AND_LOCATION, perms);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>##第二种写法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">EasyPermissions.requestPermissions(</span><br><span class="line">       new PermissionRequest.Builder(this, RC_CAMERA_AND_LOCATION, perms)</span><br><span class="line">               .setRationale(R.string.camera_and_location_rationale)</span><br><span class="line">               .setPositiveButtonText(R.string.rationale_ask_ok)</span><br><span class="line">               .setNegativeButtonText(R.string.rationale_ask_cancel)</span><br><span class="line">               .setTheme(R.style.my_fancy_style)</span><br><span class="line">               .build());</span><br></pre></td></tr></table></figure>
<p>重写授权成功和失败的回调</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">   public void onRequestPermissionsResult(int requestCode, String[] permissions, int[] grantResults) &#123;</span><br><span class="line">       super.onRequestPermissionsResult(requestCode, permissions, grantResults);</span><br><span class="line"></span><br><span class="line">       // Forward results to EasyPermissions</span><br><span class="line">       EasyPermissions.onRequestPermissionsResult(requestCode, permissions, grantResults, this);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   @Override</span><br><span class="line">   public void onPermissionsGranted(int requestCode, List&lt;String&gt; list) &#123;</span><br><span class="line">       // Some permissions have been granted</span><br><span class="line">       // ...</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   @Override</span><br><span class="line">   public void onPermissionsDenied(int requestCode, List&lt;String&gt; list) &#123;</span><br><span class="line">       // Some permissions have been denied</span><br><span class="line">       // ...</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>##更多使用请参考：</p>
<p><a href="https://github.com/googlesamples/easypermissions" target="_blank" rel="noopener">https://github.com/googlesamples/easypermissions</a></p>
<p>##另外再推荐几个不错的处理动态权限的开源库：</p>
<p>前面的star基本都是几k,后面的都是几百的star</p>
<p><a href="https://github.com/tbruyelle/RxPermissions" target="_blank" rel="noopener">https://github.com/tbruyelle/RxPermissions</a></p>
<p><a href="https://github.com/hongyangAndroid/MPermissions" target="_blank" rel="noopener">https://github.com/hongyangAndroid/MPermissions</a></p>
<p><a href="https://github.com/yanzhenjie/AndPermission" target="_blank" rel="noopener">https://github.com/yanzhenjie/AndPermission</a></p>
<p><a href="https://github.com/permissions-dispatcher/PermissionsDispatcher" target="_blank" rel="noopener">https://github.com/permissions-dispatcher/PermissionsDispatcher</a></p>
<p><a href="https://github.com/jokermonn/permissions4m" target="_blank" rel="noopener">https://github.com/jokermonn/permissions4m</a></p>
<p><a href="https://github.com/lovedise/PermissionGen" target="_blank" rel="noopener">https://github.com/lovedise/PermissionGen</a></p>
<p><a href="https://github.com/k0shk0sh/PermissionHelper" target="_blank" rel="noopener">https://github.com/k0shk0sh/PermissionHelper</a></p>
<p>支持Kotlin:<a href="https://github.com/googlesamples/android-RuntimePermissions" target="_blank" rel="noopener">https://github.com/googlesamples/android-RuntimePermissions</a></p>
<p><a href="https://github.com/mylhyl/AndroidAcp" target="_blank" rel="noopener">https://github.com/mylhyl/AndroidAcp</a></p>
<p><a href="https://github.com/ParkSangGwon/TedPermission" target="_blank" rel="noopener">https://github.com/ParkSangGwon/TedPermission</a></p>
<p><a href="https://github.com/yewei02538/HiPermission" target="_blank" rel="noopener">https://github.com/yewei02538/HiPermission</a></p>
<p><a href="https://github.com/PEXPlugins/PermissionsEx" target="_blank" rel="noopener">https://github.com/PEXPlugins/PermissionsEx</a></p>
<p><a href="https://github.com/dfqin/PermissionGrantor" target="_blank" rel="noopener">https://github.com/dfqin/PermissionGrantor</a></p>
<p>##更多Google官网文档关于动态权限的说明</p>
<p><a href="https://developer.android.com/guide/topics/security/permissions.html" target="_blank" rel="noopener">https://developer.android.com/guide/topics/security/permissions.html</a></p>
<p><a href="https://developer.android.com/training/permissions/requesting.html" target="_blank" rel="noopener">https://developer.android.com/training/permissions/requesting.html</a></p>
<p><a href="https://developer.android.com/training/permissions/best-practices.html" target="_blank" rel="noopener">https://developer.android.com/training/permissions/best-practices.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.vance.xin/2017/09/24/Android最新手机号正则判断/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="程序员飞飞">
      <meta itemprop="description" content="Android、Java Developer.">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="程序员飞飞">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2017/09/24/Android最新手机号正则判断/" class="post-title-link" itemprop="url">Android 最新手机号正则判断</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-09-24 23:47:57" itemprop="dateCreated datePublished" datetime="2017-09-24T23:47:57+08:00">2017-09-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-12-08 23:33:12" itemprop="dateModified" datetime="2018-12-08T23:33:12+08:00">2018-12-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index"><span itemprop="name">Android</span></a>
                </span>
            </span>

          
            <span id="/2017/09/24/Android最新手机号正则判断/" class="post-meta-item leancloud_visitors" data-flag-title="Android 最新手机号正则判断" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2017/09/24/Android最新手机号正则判断/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2017/09/24/Android最新手机号正则判断/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <pre><code>/**
 * 匹配手机号的规则：[3578]是手机号第二位可能出现的数字
 */
public static final String REGEX_MOBILE = &quot;^[1][3578][0-9]{9}$&quot;;

/**
 * 校验手机号
 * @param mobile
 * @return 校验通过返回true，否则返回false
 */
public static boolean isMobile(String mobile) {
    return Pattern.matches(REGEX_MOBILE, mobile);
}


1、手机号开头集合
176，177，178,  
180，181，182,183,184,185，186，187,188。，189。  
145，147   
130，131，132，133，134,135,136,137, 138,139  
150,151, 152,153，155，156，157,158,159,  


2、正则表达式

public static boolean isChinaPhoneLegal(String str)  
            throws PatternSyntaxException {  
        String regExp = &quot;^((13[0-9])|(15[^4])|(18[0-9])|(17[0-8])|(147,145))\\d{8}$&quot;;  
        Pattern p = Pattern.compile(regExp);  
        Matcher m = p.matcher(str);  
        return m.matches();  
    }  
</code></pre><p>13开头的后面跟0-9的任意8位数；</p>
<p>15开头的后面跟除了4以外的0-9的任意8位数；</p>
<p>18开头的后面跟0-9的任意8位数；</p>
<p>17开头的后面跟0-8的任意8位数，或者17[^9]；</p>
<p>147，145开头后面跟任意8位数；</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/8/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/10/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">程序员飞飞</p>
  <div class="site-description" itemprop="description">Android、Java Developer.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">95</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">129</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/xinpengfei520" title="GitHub → https://github.com/xinpengfei520" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:542270559@qq.com" title="E-Mail → mailto:542270559@qq.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/xinpengfei521" title="CSDN → https://blog.csdn.net/xinpengfei521" rel="noopener" target="_blank"><i class="heartbeat fa-fw"></i>CSDN</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://juejin.im/user/57c82d0779bc440063eac0f8/posts" title="掘金 → https://juejin.im/user/57c82d0779bc440063eac0f8/posts" rel="noopener" target="_blank"><i class="crosshairs fa-fw"></i>掘金</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://open.weixin.qq.com/qr/code?username=x-sir123" title="公众号 → https://open.weixin.qq.com/qr/code?username=x-sir123" rel="noopener" target="_blank"><i class="weixin fa-fw"></i>公众号</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/xin-peng-fei-9/activities" title="知乎 → https://www.zhihu.com/people/xin-peng-fei-9/activities" rel="noopener" target="_blank"><i class="tablet fa-fw"></i>知乎</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/p/1005051783451275/home?from=page_100505&mod=TAB&is_all=1#place" title="微博 → https://weibo.com/p/1005051783451275/home?from=page_100505&mod=TAB&is_all=1#place" rel="noopener" target="_blank"><i class="weibo fa-fw"></i>微博</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.jianshu.com/u/268aa8e1a12f" title="简书 → https://www.jianshu.com/u/268aa8e1a12f" rel="noopener" target="_blank"><i class="desktop fa-fw"></i>简书</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">程序员飞飞</span>
</div>



<div style="width:580px;margin:0 auto; padding:20px 0;">
	<a target="_blank" href="https://beian.miit.gov.cn/" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">沪ICP备2022014461号-1 </p></a>

	<a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=61032202000124" style="display:inline-block;text-decoration:none;height:20px;line-height:20px;"><img src="images/beian_pic.png" style="float:left;"><p style="float:left;height:20px;line-height:20px;margin: 0px 0px 0px 5px; color:#939393;">陕公网安备 61032202000124号</p></a>
</div>

        






<script>
  (function() {
    function leancloudSelector(url) {
      url = encodeURI(url);
      return document.getElementById(url).querySelector('.leancloud-visitors-count');
    }

    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = decodeURI(visitors.id);
      var title = visitors.dataset.flagTitle;

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url })))
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
            leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .catch(error => {
                console.error('Failed to save visitor count', error);
              });
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return decodeURI(element.id);
      });

      Counter('get', '/classes/Counter?where=' + encodeURIComponent(JSON.stringify({ url: { '$in': entries } })))
        .then(response => response.json())
        .then(({ results }) => {
          for (let url of entries) {
            let target = results.find(item => item.url === url);
            leancloudSelector(url).innerText = target ? target.time : 0;
          }
        })
        .catch(error => {
          console.error('LeanCloud Counter Error', error);
        });
    }

    let { app_id, app_key, server_url } = {"enable":true,"app_id":"G3y7KUGt4YotKOozJ9fiS3cp-gzGzoHsz","app_key":"Hm8TNHlKhiv0i2VwIXIE3oY9","server_url":null,"security":true};
    function fetchData(api_server) {
      var Counter = (method, url, data) => {
        return fetch(`${api_server}/1.1${url}`, {
          method,
          headers: {
            'X-LC-Id'     : app_id,
            'X-LC-Key'    : app_key,
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        if (CONFIG.hostname !== location.hostname) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    }

    let api_server = app_id.slice(-9) !== '-MdYXbMMI' ? server_url : `https://${app_id.slice(0, 8).toLowerCase()}.api.lncldglobal.com`;

    if (api_server) {
      fetchData(api_server);
    } else {
      fetch('https://app-router.leancloud.cn/2/route?appId=' + app_id)
        .then(response => response.json())
        .then(({ api_server }) => {
          fetchData('https://' + api_server);
        });
    }
  })();
</script>


      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>












  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'G3y7KUGt4YotKOozJ9fiS3cp-gzGzoHsz',
      appKey     : 'Hm8TNHlKhiv0i2VwIXIE3oY9',
      placeholder: "既然来了，就留个脚印再走吧！",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"right","width":110,"height":180},"mobile":{"show":false},"log":false,"tagMode":false});</script></body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>